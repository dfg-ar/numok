This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-02-13T14:19:09.608Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

================================================================
Directory Structure
================================================================
database/
  numok-0-1.sql
public/
  assets/
    favicon/
      about.txt
      site.webmanifest
  .htaccess
  index.php
src/
  Controllers/
    AuthController.php
    Controller.php
    ConversionsController.php
    DashboardController.php
    PartnerAuthController.php
    PartnerBaseController.php
    PartnerDashboardController.php
    PartnerProfileController.php
    PartnerProgramsController.php
    PartnersController.php
    ProgramsController.php
    SettingsController.php
    TrackingController.php
    WebhookController.php
  Database/
    Database.php
  Middleware/
    AuthMiddleware.php
    PartnerMiddleware.php
  Services/
    ProgramScriptGenerator.php
  Views/
    auth/
      login.php
    conversions/
      index.php
    dashboard/
      index.php
    layouts/
      footer.php
      header.php
    partner/
      auth/
        login.php
        register.php
      dashboard/
        index.php
      layouts/
        footer.php
        header.php
      programs/
        index.php
      settings/
        index.php
    partners/
      create.php
      edit.php
      index.php
    programs/
      create.php
      edit.php
      index.php
      integration.php
    settings/
      index.php
.gitignore
composer.json
composer.lock
readme.md

================================================================
Files
================================================================

================
File: database/numok-0-1.sql
================
/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
SET NAMES utf8mb4;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE='NO_AUTO_VALUE_ON_ZERO', SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;


# Dump of table clicks
# ------------------------------------------------------------

DROP TABLE IF EXISTS `clicks`;

CREATE TABLE `clicks` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `partner_program_id` int unsigned NOT NULL,
  `click_id` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `ip_address` varchar(45) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `user_agent` text COLLATE utf8mb4_unicode_ci,
  `referer` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `sub_ids` json DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `click_id` (`click_id`),
  KEY `partner_program_id` (`partner_program_id`),
  KEY `idx_click_id` (`click_id`),
  CONSTRAINT `clicks_ibfk_1` FOREIGN KEY (`partner_program_id`) REFERENCES `partner_programs` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;



# Dump of table conversions
# ------------------------------------------------------------

DROP TABLE IF EXISTS `conversions`;

CREATE TABLE `conversions` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `partner_program_id` int unsigned NOT NULL,
  `stripe_payment_id` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
  `amount` decimal(10,2) NOT NULL,
  `commission_amount` decimal(10,2) NOT NULL,
  `status` enum('pending','payable','rejected','paid') COLLATE utf8mb4_unicode_ci DEFAULT 'pending',
  `customer_email` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `metadata` json DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `stripe_payment_id` (`stripe_payment_id`),
  KEY `partner_program_id` (`partner_program_id`),
  KEY `idx_stripe_payment` (`stripe_payment_id`),
  CONSTRAINT `conversions_ibfk_1` FOREIGN KEY (`partner_program_id`) REFERENCES `partner_programs` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;



# Dump of table logs
# ------------------------------------------------------------

DROP TABLE IF EXISTS `logs`;

CREATE TABLE `logs` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `type` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `message` text COLLATE utf8mb4_unicode_ci NOT NULL,
  `context` json DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_type` (`type`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;



# Dump of table partner_programs
# ------------------------------------------------------------

DROP TABLE IF EXISTS `partner_programs`;

CREATE TABLE `partner_programs` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `partner_id` int unsigned NOT NULL,
  `program_id` int unsigned NOT NULL,
  `tracking_code` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `postback_url` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `status` enum('active','inactive') COLLATE utf8mb4_unicode_ci DEFAULT 'active',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `tracking_code` (`tracking_code`),
  KEY `partner_id` (`partner_id`),
  KEY `program_id` (`program_id`),
  KEY `idx_tracking_code` (`tracking_code`),
  CONSTRAINT `partner_programs_ibfk_1` FOREIGN KEY (`partner_id`) REFERENCES `partners` (`id`) ON DELETE CASCADE,
  CONSTRAINT `partner_programs_ibfk_2` FOREIGN KEY (`program_id`) REFERENCES `programs` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


# Dump of table partners
# ------------------------------------------------------------

DROP TABLE IF EXISTS `partners`;

CREATE TABLE `partners` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `email` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `password` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `company_name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `contact_name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `status` enum('pending','active','rejected','suspended') COLLATE utf8mb4_unicode_ci DEFAULT 'pending',
  `payment_email` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

# Dump of table programs
# ------------------------------------------------------------

DROP TABLE IF EXISTS `programs`;

CREATE TABLE `programs` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `description` text COLLATE utf8mb4_unicode_ci,
  `commission_type` enum('percentage','fixed') COLLATE utf8mb4_unicode_ci NOT NULL,
  `commission_value` decimal(10,2) NOT NULL,
  `cookie_days` int unsigned DEFAULT '30',
  `is_recurring` tinyint(1) DEFAULT '0',
  `reward_days` int unsigned DEFAULT '0',
  `landing_page` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `status` enum('active','inactive') COLLATE utf8mb4_unicode_ci DEFAULT 'active',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


# Dump of table settings
# ------------------------------------------------------------

DROP TABLE IF EXISTS `settings`;

CREATE TABLE `settings` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL,
  `value` text COLLATE utf8mb4_unicode_ci,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`),
  KEY `idx_setting_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


# Dump of table users
# ------------------------------------------------------------

DROP TABLE IF EXISTS `users`;

CREATE TABLE `users` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `email` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `password` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `is_admin` tinyint(1) DEFAULT '0',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;

================
File: public/assets/favicon/about.txt
================
This favicon was generated using the following font:

- Font Title: Nunito
- Font Author: undefined
- Font Source: https://fonts.gstatic.com/s/nunito/v26/XRXI3I6Li01BKofiOc5wtlZ2di8HDLshRTM9jo7eTWk.ttf
- Font License: undefined)

================
File: public/assets/favicon/site.webmanifest
================
{"name":"","short_name":"","icons":[{"src":"/android-chrome-192x192.png","sizes":"192x192","type":"image/png"},{"src":"/android-chrome-512x512.png","sizes":"512x512","type":"image/png"}],"theme_color":"#ffffff","background_color":"#ffffff","display":"standalone"}

================
File: public/.htaccess
================
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [QSA,L]

# CORS Headers
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
Header set Access-Control-Allow-Headers "Content-Type"
Header set Access-Control-Max-Age "86400"

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-XSS-Protection "1; mode=block"
Header set X-Frame-Options "SAMEORIGIN"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# Handle OPTIONS request
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

================
File: public/index.php
================
<?php
declare(strict_types=1);

// Start session
session_start();

// Initialize error reporting for development
error_reporting(E_ALL);
ini_set('display_errors', '1');

// Define root path
define('ROOT_PATH', dirname(__DIR__));

// Autoload dependencies
require_once ROOT_PATH . '/vendor/autoload.php';

// Load configuration
require_once ROOT_PATH . '/config/config.php';

// Get the path
$path = $_SERVER['REQUEST_URI'];
$path = parse_url($path, PHP_URL_PATH);
$path = trim($path, '/');

// Define routes
$routes = [
    // Partner routes (root level)
    '' => ['PartnerDashboardController', 'index'],
    'login' => ['PartnerAuthController', 'index'],
    'auth/login' => ['PartnerAuthController', 'login'],
    'register' => ['PartnerAuthController', 'register'],
    'auth/register' => ['PartnerAuthController', 'store'],
    'settings' => ['PartnerProfileController', 'index'],
    'settings/update' => ['PartnerProfileController', 'update'],
    'logout' => ['PartnerAuthController', 'logout'],
    'dashboard' => ['PartnerDashboardController', 'index'],
    'tracking' => ['PartnerTrackingController', 'index'],
    'earnings' => ['PartnerEarningsController', 'index'],
    'programs' => ['PartnerProgramsController', 'index'],
    'programs/join' => ['PartnerProgramsController', 'join'],

    // Admin routes (under /admin)
    'admin' => ['DashboardController', 'index'],
    'admin/login' => ['AuthController', 'index'],
    'admin/auth/login' => ['AuthController', 'login'],
    'admin/logout' => ['AuthController', 'logout'],
    'admin/dashboard' => ['DashboardController', 'index'],
    'admin/settings' => ['SettingsController', 'index'],
    'admin/settings/update' => ['SettingsController', 'update'],
    'admin/settings/update-profile' => ['SettingsController', 'updateProfile'],
    'admin/settings/test-connection' => ['SettingsController', 'testConnection'],
    
    // Programs routes
    'admin/programs' => ['ProgramsController', 'index'],
    'admin/programs/create' => ['ProgramsController', 'create'],
    'admin/programs/store' => ['ProgramsController', 'store'],
    'admin/programs/(\d+)/edit' => ['ProgramsController', 'edit'],
    'admin/programs/(\d+)/integration' => ['ProgramsController', 'integration'],
    'admin/programs/(\d+)/update' => ['ProgramsController', 'update'],
    'admin/programs/(\d+)/delete' => ['ProgramsController', 'delete'],

    // Partners routes
    'admin/partners' => ['PartnersController', 'index'],
    'admin/partners/create' => ['PartnersController', 'create'],
    'admin/partners/store' => ['PartnersController', 'store'],
    'admin/partners/(\d+)/edit' => ['PartnersController', 'edit'],
    'admin/partners/(\d+)/update' => ['PartnersController', 'update'],
    'admin/partners/(\d+)/delete' => ['PartnersController', 'delete'],
    'admin/partners/(\d+)/assign-program' => ['PartnersController', 'assignProgram'],

    // Conversions routes
    'admin/conversions' => ['ConversionsController', 'index'],
    'admin/conversions/update-status' => ['ConversionsController', 'updateStatus'],
    'admin/conversions/export' => ['ConversionsController', 'export'],

    // API routes
    'api/tracking/config/(\d+)' => ['TrackingController', 'config'],
    'api/tracking/click' => ['TrackingController', 'click'],

    // Webhook routes
    'webhook/stripe' => ['WebhookController', 'stripeWebhook'],
];

// Check if route exists or matches a pattern
$matched = false;

foreach ($routes as $pattern => $route) {
    $pattern = str_replace('/', '\/', $pattern);
    if (preg_match('/^' . $pattern . '$/', $path, $matches)) {
        // Remove the full match from the matches array
        array_shift($matches);
        
        // Get controller and method
        $controllerName = "Numok\\Controllers\\" . $route[0];
        $methodName = $route[1];

        try {
            // Create controller instance
            $controller = new $controllerName();
            
            // Type cast numeric parameters to integer
            $params = array_map(function($value) {
                return is_numeric($value) ? (int)$value : $value;
            }, $matches);
            
            // Call the method with any captured parameters
            $controller->$methodName(...$params);
            
            $matched = true;
            break;
        } catch (\Exception $e) {
            // Log error
            error_log($e->getMessage());
            
            // Show error in development
            if (isset($config['app']['debug']) && $config['app']['debug']) {
                throw $e;
            }
            
            // Show 500 error in production
            http_response_code(500);
            echo "500 - Internal Server Error";
            exit;
        }
    }
}

if (!$matched) {
    http_response_code(404);
    echo "404 - Page Not Found";
    exit;
}

================
File: src/Controllers/AuthController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;

class AuthController extends Controller {
    public function index(): void {
        // If already logged in, redirect to dashboard
        if ($this->isLoggedIn()) {
            header('Location: /admin/dashboard');
            exit;
        }
        
        $error = $_SESSION['login_error'] ?? '';
        unset($_SESSION['login_error']);
        
        $this->view('auth/login', [
            'title' => 'Login - Numok',
            'error' => $error
        ]);
    }

    public function login(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/login');
            exit;
        }

        $email = $_POST['email'] ?? '';
        $password = $_POST['password'] ?? '';

        if (empty($email) || empty($password)) {
            $_SESSION['login_error'] = 'Email and password are required';
            header('Location: /admin/login');
            exit;
        }
        
        $stmt = Database::query(
            "SELECT * FROM users WHERE email = ? LIMIT 1", 
            [$email]
        );
        
        $user = $stmt->fetch();

        if (!$user) {
            $_SESSION['login_error'] = 'User not found';
            header('Location: /admin/login');
            exit;
        }

        if (!password_verify($password, $user['password'])) {
            $_SESSION['login_error'] = 'Invalid password';
            header('Location: /admin/login');
            exit;
        }

        // Set session
        $_SESSION['user_id'] = $user['id'];
        $_SESSION['user_email'] = $user['email'];
        $_SESSION['user_name'] = $user['name'];
        $_SESSION['is_admin'] = $user['is_admin'];
        
        // Regenerate session ID for security
        session_regenerate_id(true);
        
        header('Location: /admin/dashboard');
        exit;
    }

    public function logout(): void {
        // Clear session
        $_SESSION = [];
        
        // Clear session cookie
        if (isset($_COOKIE[session_name()])) {
            setcookie(session_name(), '', time() - 3600, '/');
        }
        
        // Destroy session
        session_destroy();
        
        header('Location: /admin/login');
        exit;
    }

    private function isLoggedIn(): bool {
        return isset($_SESSION['user_id']);
    }
}

================
File: src/Controllers/Controller.php
================
<?php

namespace Numok\Controllers;

class Controller {
    
    protected function handlePreflightRequest(): void {
        if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
            header('Access-Control-Allow-Origin: *');
            header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
            header('Access-Control-Allow-Headers: Content-Type');
            header('Access-Control-Max-Age: 86400');
            http_response_code(200);
            exit;
        }
    }

    protected function view(string $template, array $data = []): void {
        extract($data);
        
        require ROOT_PATH . "/src/Views/layouts/header.php";
        require ROOT_PATH . "/src/Views/{$template}.php";
        require ROOT_PATH . "/src/Views/layouts/footer.php";
    }

    protected function json(array $data): void {
        // Add CORS headers for all API responses
        header('Access-Control-Allow-Origin: *');
        header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
        header('Access-Control-Allow-Headers: Content-Type');
        header('Access-Control-Max-Age: 86400');
        
        header('Content-Type: application/json');
        echo json_encode($data);
    }
}

================
File: src/Controllers/ConversionsController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\AuthMiddleware;

class ConversionsController extends Controller {
    public function __construct() {
        AuthMiddleware::handle();
    }

    public function index(): void {
        // Get filter parameters
        $status = $_GET['status'] ?? 'all';
        $partnerId = intval($_GET['partner_id'] ?? 0);
        $programId = intval($_GET['program_id'] ?? 0);
        $startDate = $_GET['start_date'] ?? '';
        $endDate = $_GET['end_date'] ?? '';

        // Build query conditions
        $conditions = [];
        $params = [];

        if ($status !== 'all') {
            $conditions[] = "c.status = ?";
            $params[] = $status;
        }

        if ($partnerId > 0) {
            $conditions[] = "p.id = ?";
            $params[] = $partnerId;
        }

        if ($programId > 0) {
            $conditions[] = "prog.id = ?";
            $params[] = $programId;
        }

        if ($startDate) {
            $conditions[] = "DATE(c.created_at) >= ?";
            $params[] = $startDate;
        }

        if ($endDate) {
            $conditions[] = "DATE(c.created_at) <= ?";
            $params[] = $endDate;
        }

        $whereClause = $conditions ? 'WHERE ' . implode(' AND ', $conditions) : '';

        // Get conversions with joins
        $conversions = Database::query(
            "SELECT c.*, 
                    p.company_name as partner_name,
                    prog.name as program_name,
                    pp.tracking_code
             FROM conversions c
             JOIN partner_programs pp ON c.partner_program_id = pp.id
             JOIN partners p ON pp.partner_id = p.id
             JOIN programs prog ON pp.program_id = prog.id
             {$whereClause}
             ORDER BY c.created_at DESC
             LIMIT 100",
            $params
        )->fetchAll();

        // Get all partners for filter
        $partners = Database::query(
            "SELECT id, company_name FROM partners WHERE status = 'active' ORDER BY company_name"
        )->fetchAll();

        // Get all programs for filter
        $programs = Database::query(
            "SELECT id, name FROM programs WHERE status = 'active' ORDER BY name"
        )->fetchAll();

        // Calculate totals
        $totals = [
            'count' => count($conversions),
            'amount' => array_sum(array_column($conversions, 'amount')),
            'commission' => array_sum(array_column($conversions, 'commission_amount'))
        ];

        $this->view('conversions/index', [
            'title' => 'Conversions - Numok',
            'conversions' => $conversions,
            'partners' => $partners,
            'programs' => $programs,
            'totals' => $totals,
            'filters' => [
                'status' => $status,
                'partner_id' => $partnerId,
                'program_id' => $programId,
                'start_date' => $startDate,
                'end_date' => $endDate
            ]
        ]);
    }

    public function updateStatus(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/conversions');
            exit;
        }

        $id = intval($_POST['id'] ?? 0);
        $status = $_POST['status'] ?? '';

        if (!$id || !in_array($status, ['pending', 'payable', 'rejected', 'paid'])) {
            $_SESSION['error'] = 'Invalid request parameters';
            header('Location: /admin/conversions');
            exit;
        }

        try {
            Database::update(
                'conversions',
                ['status' => $status],
                'id = ?',
                [$id]
            );

            $_SESSION['success'] = 'Conversion status updated successfully.';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to update conversion status.';
        }

        header('Location: /admin/conversions');
        exit;
    }

    public function export(): void {
        // Set headers for CSV download
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment; filename="conversions.csv"');

        // Create output handle
        $output = fopen('php://output', 'w');

        // Add CSV headers
        fputcsv($output, [
            'Date',
            'Partner',
            'Program',
            'Tracking Code',
            'Customer Email',
            'Amount',
            'Commission',
            'Status'
        ]);

        // Get all conversions
        $conversions = Database::query(
            "SELECT 
                c.created_at,
                p.company_name as partner_name,
                prog.name as program_name,
                pp.tracking_code,
                c.customer_email,
                c.amount,
                c.commission_amount,
                c.status
             FROM conversions c
             JOIN partner_programs pp ON c.partner_program_id = pp.id
             JOIN partners p ON pp.partner_id = p.id
             JOIN programs prog ON pp.program_id = prog.id
             ORDER BY c.created_at DESC"
        )->fetchAll();

        // Add data rows
        foreach ($conversions as $conversion) {
            fputcsv($output, [
                date('Y-m-d H:i:s', strtotime($conversion['created_at'])),
                $conversion['partner_name'],
                $conversion['program_name'],
                $conversion['tracking_code'],
                $conversion['customer_email'],
                number_format($conversion['amount'], 2),
                number_format($conversion['commission_amount'], 2),
                ucfirst($conversion['status'])
            ]);
        }

        fclose($output);
        exit;
    }
}

================
File: src/Controllers/DashboardController.php
================
<?php

namespace Numok\Controllers;

use Numok\Middleware\AuthMiddleware;
use Numok\Database\Database;

class DashboardController extends Controller {
    public function __construct() {
        AuthMiddleware::handle();
    }

    public function index(): void {
        // Get basic stats
        $stats = $this->getStats();
        
        // Get recent conversions
        $conversions = $this->getRecentConversions();

        $this->view('dashboard/index', [
            'title' => 'Dashboard - Numok',
            'user_name' => $_SESSION['user_name'],
            'stats' => $stats,
            'recent_conversions' => $conversions
        ]);
    }

    private function getStats(): array {
        // Get total partners
        $partners = Database::query("SELECT COUNT(*) as count FROM partners WHERE status = 'active'")->fetch();
        
        // Get active programs
        $programs = Database::query("SELECT COUNT(*) as count FROM programs WHERE status = 'active'")->fetch();
        
        // Get this month's revenue
        $revenue = Database::query(
            "SELECT COALESCE(SUM(amount), 0) as total FROM conversions 
             WHERE MONTH(created_at) = MONTH(CURRENT_DATE()) 
             AND YEAR(created_at) = YEAR(CURRENT_DATE())"
        )->fetch();

        return [
            'total_partners' => $partners['count'],
            'active_programs' => $programs['count'],
            'monthly_revenue' => $revenue['total']
        ];
    }

    private function getRecentConversions(): array {
        return Database::query(
            "SELECT c.*, p.company_name as partner_name
             FROM conversions c
             JOIN partner_programs pp ON c.partner_program_id = pp.id
             JOIN partners p ON pp.partner_id = p.id
             ORDER BY c.created_at DESC
             LIMIT 5"
        )->fetchAll();
    }
}

================
File: src/Controllers/PartnerAuthController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;

class PartnerAuthController extends PartnerBaseController {
    public function index(): void {
        // If already logged in, redirect to partner dashboard
        if ($this->isLoggedIn()) {
            header('Location: /dashboard');
            exit;
        }
        
        $error = $_SESSION['login_error'] ?? '';
        unset($_SESSION['login_error']);
        
        $this->view('partner/auth/login', [
            'title' => 'Partner Login - Numok',
            'error' => $error
        ]);
    }

    public function login(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /login');
            exit;
        }

        $email = $_POST['email'] ?? '';
        $password = $_POST['password'] ?? '';

        if (empty($email) || empty($password)) {
            $_SESSION['login_error'] = 'Email and password are required';
            header('Location: /login');
            exit;
        }
        
        $partner = Database::query(
            "SELECT * FROM partners WHERE email = ? AND status != 'rejected' LIMIT 1", 
            [$email]
        )->fetch();

        if (!$partner) {
            $_SESSION['login_error'] = 'Account not found';
            header('Location: /login');
            exit;
        }

        if (!password_verify($password, $partner['password'])) {
            $_SESSION['login_error'] = 'Invalid password';
            header('Location: /login');
            exit;
        }

        if ($partner['status'] === 'pending') {
            $_SESSION['login_error'] = 'Your account is pending approval';
            header('Location: /login');
            exit;
        }

        if ($partner['status'] === 'suspended') {
            $_SESSION['login_error'] = 'Your account has been suspended';
            header('Location: /login');
            exit;
        }

        // Set partner session
        $_SESSION['partner_id'] = $partner['id'];
        $_SESSION['partner_email'] = $partner['email'];
        $_SESSION['partner_company'] = $partner['company_name'];
        
        // Regenerate session ID for security
        session_regenerate_id(true);
        
        header('Location: /dashboard');
        exit;
    }

    public function register(): void {
        $this->view('partner/auth/register', [
            'title' => 'Register - Numok'
        ]);
    }

    public function store(): void {
        // Debug logging
        error_log('Partner registration attempt - POST data: ' . print_r($_POST, true));
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /register');
            exit;
        }

        // Validate required fields
        $required = ['email', 'password', 'company_name', 'contact_name'];
        foreach ($required as $field) {
            if (empty($_POST[$field])) {
                $_SESSION['register_error'] = 'All fields are required';
                header('Location: /register');
                exit;
            }
        }

        // Validate email
        $email = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL);
        if (!$email) {
            $_SESSION['register_error'] = 'Valid email address is required';
            header('Location: /register');
            exit;
        }

        // Check if email already exists
        $existing = Database::query(
            "SELECT id FROM partners WHERE email = ?",
            [$email]
        )->fetch();

        if ($existing) {
            $_SESSION['register_error'] = 'This email is already registered';
            header('Location: /register');
            exit;
        }

        try {
            // Sanitize inputs
            $companyName = trim($_POST['company_name']);
            $contactName = trim($_POST['contact_name']);
            
            if (empty($companyName) || empty($contactName)) {
                $_SESSION['register_error'] = 'Company name and contact name are required';
                header('Location: /register');
                exit;
            }
            
            Database::insert('partners', [
                'email' => $email,
                'password' => password_hash($_POST['password'], PASSWORD_DEFAULT),
                'company_name' => $companyName,
                'contact_name' => $contactName,
                'payment_email' => $email,
                'status' => 'active'  // Automatically activate partners
            ]);
            
            // Log successful registration
            error_log("Partner registered successfully - Email: $email, Company: $companyName");

            $_SESSION['register_success'] = 'Registration successful!';
            header('Location: /login');
        } catch (\Exception $e) {
            $_SESSION['register_error'] = 'Registration failed. Please try again.';
            header('Location: /register');
        }
        exit;
    }

    public function logout(): void {
        // Clear session
        $_SESSION = [];
        
        if (isset($_COOKIE[session_name()])) {
            setcookie(session_name(), '', time() - 3600, '/');
        }
        
        session_destroy();
        
        header('Location: /login');
        exit;
    }

    private function isLoggedIn(): bool {
        return isset($_SESSION['partner_id']);
    }
}

================
File: src/Controllers/PartnerBaseController.php
================
<?php

namespace Numok\Controllers;

class PartnerBaseController extends Controller {
    protected function view(string $template, array $data = []): void {
        extract($data);
        
        require ROOT_PATH . "/src/Views/partner/layouts/header.php";
        require ROOT_PATH . "/src/Views/{$template}.php";
        require ROOT_PATH . "/src/Views/partner/layouts/footer.php";
    }
}

================
File: src/Controllers/PartnerDashboardController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\PartnerMiddleware;

class PartnerDashboardController extends PartnerBaseController {
    public function __construct() {
        PartnerMiddleware::handle();
    }

    public function index(): void {
        $partnerId = $_SESSION['partner_id'];

        // Get basic stats
        $stats = $this->getStats($partnerId);
        
        // Get recent conversions
        $conversions = $this->getRecentConversions($partnerId);

        // Get active programs
        $programs = $this->getActivePrograms($partnerId);

        $this->view('partner/dashboard/index', [
            'title' => 'Partner Dashboard - Numok',
            'stats' => $stats,
            'conversions' => $conversions,
            'programs' => $programs
        ]);
    }

    private function getStats(int $partnerId): array {
        // Get total conversions and revenue
        $stats = Database::query(
            "SELECT 
                COUNT(c.id) as total_conversions,
                COALESCE(SUM(c.amount), 0) as total_revenue,
                COALESCE(SUM(c.commission_amount), 0) as total_commission
             FROM conversions c
             JOIN partner_programs pp ON c.partner_program_id = pp.id
             WHERE pp.partner_id = ?",
            [$partnerId]
        )->fetch();

        // Get this month's conversions
        $monthlyStats = Database::query(
            "SELECT 
                COUNT(c.id) as conversions,
                COALESCE(SUM(c.amount), 0) as revenue,
                COALESCE(SUM(c.commission_amount), 0) as commission
             FROM conversions c
             JOIN partner_programs pp ON c.partner_program_id = pp.id
             WHERE pp.partner_id = ?
             AND MONTH(c.created_at) = MONTH(CURRENT_DATE())
             AND YEAR(c.created_at) = YEAR(CURRENT_DATE())",
            [$partnerId]
        )->fetch();

        // Get active programs count
        $programs = Database::query(
            "SELECT COUNT(*) as count 
             FROM partner_programs 
             WHERE partner_id = ? AND status = 'active'",
            [$partnerId]
        )->fetch();

        return [
            'total_conversions' => $stats['total_conversions'] ?? 0,
            'total_revenue' => $stats['total_revenue'] ?? 0,
            'total_commission' => $stats['total_commission'] ?? 0,
            'monthly_conversions' => $monthlyStats['conversions'] ?? 0,
            'monthly_revenue' => $monthlyStats['revenue'] ?? 0,
            'monthly_commission' => $monthlyStats['commission'] ?? 0,
            'active_programs' => $programs['count'] ?? 0
        ];
    }

    private function getRecentConversions(int $partnerId): array {
        return Database::query(
            "SELECT c.*, p.name as program_name, pp.tracking_code
             FROM conversions c
             JOIN partner_programs pp ON c.partner_program_id = pp.id
             JOIN programs p ON pp.program_id = p.id
             WHERE pp.partner_id = ?
             ORDER BY c.created_at DESC
             LIMIT 5",
            [$partnerId]
        )->fetchAll();
    }

    private function getActivePrograms(int $partnerId): array {
        return Database::query(
            "SELECT pp.*, p.name as program_name, p.description,
                    p.commission_type, p.commission_value,
                    COUNT(c.id) as total_conversions,
                    COALESCE(SUM(c.amount), 0) as total_revenue,
                    COALESCE(SUM(c.commission_amount), 0) as total_commission
             FROM partner_programs pp
             JOIN programs p ON pp.program_id = p.id
             LEFT JOIN conversions c ON c.partner_program_id = pp.id
             WHERE pp.partner_id = ? AND pp.status = 'active'
             GROUP BY pp.id
             ORDER BY total_revenue DESC",
            [$partnerId]
        )->fetchAll();
    }
}

================
File: src/Controllers/PartnerProfileController.php
================
<?php
// src/Controllers/PartnerProfileController.php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\PartnerMiddleware;

class PartnerProfileController extends PartnerBaseController {
    public function __construct() {
        PartnerMiddleware::handle();
    }

    public function index(): void {
        // Get current partner data
        $partner = Database::query(
            "SELECT * FROM partners WHERE id = ? LIMIT 1",
            [$_SESSION['partner_id']]
        )->fetch();

        $this->view('partner/settings/index', [
            'title' => 'Account Settings - Numok',
            'partner' => $partner
        ]);
    }

    public function update(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /settings');
            exit;
        }

        $partnerId = $_SESSION['partner_id'];
        $currentPassword = $_POST['current_password'] ?? '';
        $newEmail = filter_var($_POST['email'] ?? '', FILTER_VALIDATE_EMAIL);
        $paymentEmail = filter_var($_POST['payment_email'] ?? '', FILTER_VALIDATE_EMAIL);
        $newPassword = $_POST['new_password'] ?? '';
        $confirmPassword = $_POST['confirm_password'] ?? '';

        try {
            // Verify current partner
            $partner = Database::query(
                "SELECT * FROM partners WHERE id = ? LIMIT 1",
                [$partnerId]
            )->fetch();

            if (!$partner || !password_verify($currentPassword, $partner['password'])) {
                $_SESSION['settings_error'] = 'Current password is incorrect';
                header('Location: /settings');
                exit;
            }

            $updates = [];
            $params = [];

            // Handle email update
            if ($newEmail && $newEmail !== $partner['email']) {
                // Check if email is already taken
                $existing = Database::query(
                    "SELECT id FROM partners WHERE email = ? AND id != ? LIMIT 1",
                    [$newEmail, $partnerId]
                )->fetch();

                if ($existing) {
                    $_SESSION['settings_error'] = 'Email address is already in use';
                    header('Location: /settings');
                    exit;
                }

                $updates[] = "email = ?";
                $params[] = $newEmail;
            }

            // Handle payment email update
            if ($paymentEmail && $paymentEmail !== $partner['payment_email']) {
                $updates[] = "payment_email = ?";
                $params[] = $paymentEmail;
            }

            // Handle password update
            if ($newPassword) {
                if (strlen($newPassword) < 8) {
                    $_SESSION['settings_error'] = 'New password must be at least 8 characters long';
                    header('Location: /settings');
                    exit;
                }

                if ($newPassword !== $confirmPassword) {
                    $_SESSION['settings_error'] = 'New passwords do not match';
                    header('Location: /settings');
                    exit;
                }

                $updates[] = "password = ?";
                $params[] = password_hash($newPassword, PASSWORD_DEFAULT);
            }

            // If there are updates to make
            if (!empty($updates)) {
                $params[] = $partnerId;
                Database::query(
                    "UPDATE partners SET " . implode(', ', $updates) . " WHERE id = ?",
                    $params
                );

                // Update session if email changed
                if ($newEmail && $newEmail !== $partner['email']) {
                    $_SESSION['partner_email'] = $newEmail;
                }

                $_SESSION['settings_success'] = 'Profile updated successfully';
            }

        } catch (\Exception $e) {
            error_log("Partner profile update error: " . $e->getMessage());
            $_SESSION['settings_error'] = 'Failed to update profile. Please try again.';
        }

        header('Location: /settings');
        exit;
    }
}

================
File: src/Controllers/PartnerProgramsController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\PartnerMiddleware;

class PartnerProgramsController extends PartnerBaseController {
    public function __construct() {
        PartnerMiddleware::handle();
    }

    public function index(): void {
        $partnerId = $_SESSION['partner_id'];

        // Get all active programs
        $programs = Database::query(
            "SELECT p.*, 
                    CASE 
                        WHEN pp.id IS NOT NULL THEN 'joined'
                        ELSE 'available'
                    END as status,
                    pp.tracking_code
             FROM programs p
             LEFT JOIN partner_programs pp ON p.id = pp.program_id 
                AND pp.partner_id = ?
             WHERE p.status = 'active'
             ORDER BY p.name",
            [$partnerId]
        )->fetchAll();

        $this->view('partner/programs/index', [
            'title' => 'Available Programs - Numok',
            'programs' => $programs
        ]);
    }

    public function join(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /programs');
            exit;
        }

        $partnerId = $_SESSION['partner_id'];
        $programId = $_POST['program_id'] ?? 0;

        // Validate program exists and is active
        $program = Database::query(
            "SELECT id FROM programs WHERE id = ? AND status = 'active'",
            [$programId]
        )->fetch();

        if (!$program) {
            $_SESSION['error'] = 'Invalid program selected';
            header('Location: /programs');
            exit;
        }

        // Check if already joined
        $existing = Database::query(
            "SELECT id FROM partner_programs 
             WHERE partner_id = ? AND program_id = ?",
            [$partnerId, $programId]
        )->fetch();

        if ($existing) {
            $_SESSION['error'] = 'You have already joined this program';
            header('Location: /programs');
            exit;
        }

        // Generate unique tracking code
        $trackingCode = bin2hex(random_bytes(8));

        try {
            Database::insert('partner_programs', [
                'partner_id' => $partnerId,
                'program_id' => $programId,
                'tracking_code' => $trackingCode,
                'status' => 'active'
            ]);

            $_SESSION['success'] = 'Successfully joined the program!';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to join program. Please try again.';
        }

        header('Location: /programs');
        exit;
    }
}

================
File: src/Controllers/PartnersController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\AuthMiddleware;

class PartnersController extends Controller {
    public function __construct() {
        AuthMiddleware::handle();
    }

    public function index(): void {
        $partners = Database::query(
            "SELECT p.*, 
                    COUNT(DISTINCT pp.program_id) as total_programs,
                    COUNT(DISTINCT c.id) as total_conversions,
                    COALESCE(SUM(c.amount), 0) as total_revenue,
                    COALESCE(SUM(c.commission_amount), 0) as total_commission
             FROM partners p
             LEFT JOIN partner_programs pp ON p.id = pp.partner_id
             LEFT JOIN conversions c ON pp.id = c.partner_program_id
             GROUP BY p.id
             ORDER BY p.created_at DESC"
        )->fetchAll();

        $this->view('partners/index', [
            'title' => 'Partners - Numok',
            'partners' => $partners
        ]);
    }

    public function create(): void {
        $this->view('partners/create', [
            'title' => 'Create Partner - Numok'
        ]);
    }

    public function store(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/partners');
            exit;
        }

        // Validate email
        $email = filter_var($_POST['email'] ?? '', FILTER_VALIDATE_EMAIL);
        if (!$email) {
            $_SESSION['error'] = 'Valid email address is required';
            header('Location: /admin/partners/create');
            exit;
        }

        // Check if email already exists
        $existing = Database::query(
            "SELECT id FROM partners WHERE email = ?",
            [$email]
        )->fetch();

        if ($existing) {
            $_SESSION['error'] = 'A partner with this email already exists';
            header('Location: /admin/partners/create');
            exit;
        }

        $data = [
            'email' => $email,
            'company_name' => $_POST['company_name'] ?? '',
            'contact_name' => $_POST['contact_name'] ?? '',
            'payment_email' => $_POST['payment_email'] ?? $email,
            'status' => 'pending',
            'password' => password_hash($_POST['password'] ?? bin2hex(random_bytes(8)), PASSWORD_DEFAULT)
        ];

        try {
            Database::insert('partners', $data);
            $_SESSION['success'] = 'Partner created successfully.';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to create partner. Please try again.';
        }

        header('Location: /admin/partners');
        exit;
    }

    public function edit(int $id): void {
        $partner = Database::query(
            "SELECT * FROM partners WHERE id = ? LIMIT 1",
            [$id]
        )->fetch();

        if (!$partner) {
            $_SESSION['error'] = 'Partner not found';
            header('Location: /admin/partners');
            exit;
        }

        // Get partner's programs
        $programs = Database::query(
            "SELECT pp.*, p.name as program_name, p.commission_type, p.commission_value
             FROM partner_programs pp
             JOIN programs p ON pp.program_id = p.id
             WHERE pp.partner_id = ?
             ORDER BY p.name",
            [$id]
        )->fetchAll();

        // Get available programs (not yet assigned)
        $availablePrograms = Database::query(
            "SELECT p.* 
             FROM programs p 
             WHERE p.status = 'active'
             AND p.id NOT IN (
                 SELECT program_id 
                 FROM partner_programs 
                 WHERE partner_id = ?
             )
             ORDER BY p.name",
            [$id]
        )->fetchAll();

        $this->view('partners/edit', [
            'title' => 'Edit Partner - Numok',
            'partner' => $partner,
            'programs' => $programs,
            'availablePrograms' => $availablePrograms
        ]);
    }

    public function update(int $id): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/partners');
            exit;
        }

        // Check if partner exists
        $partner = Database::query(
            "SELECT id FROM partners WHERE id = ? LIMIT 1",
            [$id]
        )->fetch();

        if (!$partner) {
            $_SESSION['error'] = 'Partner not found';
            header('Location: /admin/partners');
            exit;
        }

        $data = [
            'payment_email' => $_POST['payment_email'] ?? '',
            'status' => $_POST['status'] ?? 'pending'
        ];

        if (!empty($_POST['company_name']))
        {
            $data['company_name'] = $_POST['company_name'] ?? '';
        }
        
        if (!empty($_POST['contact_name']))
        {
            $data['contact_name'] = $_POST['contact_name'] ?? '';
        }

        try {
            Database::update('partners', $data, 'id = ?', [$id]);
            $_SESSION['success'] = 'Partner updated successfully.';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to update partner. Please try again.';
        }

        header('Location: /admin/partners');
        exit;
    }

    public function delete(int $id): void {
        try {
            Database::query(
                "DELETE FROM partners WHERE id = ?",
                [$id]
            );
            $_SESSION['success'] = 'Partner deleted successfully.';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to delete partner. Please try again.';
        }

        header('Location: /admin/partners');
        exit;
    }

    public function assignProgram(int $id): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/partners/' . $id . '/edit');
            exit;
        }

        $programId = $_POST['program_id'] ?? 0;
        
        // Validate program exists
        $program = Database::query(
            "SELECT id FROM programs WHERE id = ? AND status = 'active'",
            [$programId]
        )->fetch();

        if (!$program) {
            $_SESSION['error'] = 'Invalid program selected';
            header('Location: /admin/partners/' . $id . '/edit');
            exit;
        }

        // Generate unique tracking code
        $trackingCode = bin2hex(random_bytes(8));

        try {
            Database::insert('partner_programs', [
                'partner_id' => $id,
                'program_id' => $programId,
                'tracking_code' => $trackingCode,
                'status' => 'active'
            ]);
            $_SESSION['success'] = 'Program assigned successfully.';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to assign program. Please try again.';
        }

        header('Location: /admin/partners/' . $id . '/edit');
        exit;
    }
}

================
File: src/Controllers/ProgramsController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\AuthMiddleware;
use Numok\Services\ProgramScriptGenerator;

class ProgramsController extends Controller {
    public function __construct() {
        AuthMiddleware::handle();
    }

    public function index(): void {
        $programs = Database::query(
            "SELECT p.*, 
                    COUNT(DISTINCT pp.partner_id) as total_partners,
                    COUNT(DISTINCT c.id) as total_conversions,
                    COALESCE(SUM(c.amount), 0) as total_revenue
             FROM programs p
             LEFT JOIN partner_programs pp ON p.id = pp.program_id
             LEFT JOIN conversions c ON pp.id = c.partner_program_id
             GROUP BY p.id
             ORDER BY p.created_at DESC"
        )->fetchAll();

        $this->view('programs/index', [
            'title' => 'Programs - Numok',
            'programs' => $programs
        ]);
    }

    public function create(): void {
        $this->view('programs/create', [
            'title' => 'Create Program - Numok'
        ]);
    }

    public function store(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/programs');
            exit;
        }
    
        $data = [
            'name' => $_POST['name'] ?? '',
            'description' => $_POST['description'] ?? '',
            'commission_type' => $_POST['commission_type'] ?? 'percentage',
            'commission_value' => floatval($_POST['commission_value'] ?? 0),
            'cookie_days' => intval($_POST['cookie_days'] ?? 30),
            'is_recurring' => isset($_POST['is_recurring']) ? 1 : 0,
            'reward_days' => intval($_POST['reward_days'] ?? 0),
            'landing_page' => $_POST['landing_page'] ?? '',
            'status' => 'active'
        ];
    
        try {
            Database::transaction(function() use ($data) {
                // Insert the program
                $id = Database::insert('programs', $data);
                
                // Get the created program
                $program = Database::query(
                    "SELECT * FROM programs WHERE id = ?",
                    [$id]
                )->fetch();
                
                // Generate tracking script
                ProgramScriptGenerator::generate($program, $_SERVER['HTTP_HOST']);
            });
    
            $_SESSION['success'] = 'Program created successfully.';
        } catch (\Exception $e) {
            error_log("Failed to create program: " . $e->getMessage());
            $_SESSION['error'] = 'Failed to create program. Please try again.';
        }
    
        header('Location: /admin/programs');
        exit;
    }

    public function edit(int $id): void {
        $program = Database::query(
            "SELECT * FROM programs WHERE id = ? LIMIT 1",
            [$id]
        )->fetch();

        if (!$program) {
            $_SESSION['error'] = 'Program not found';
            header('Location: /admin/programs');
            exit;
        }

        $this->view('programs/edit', [
            'title' => 'Edit Program - Numok',
            'program' => $program
        ]);
    }

    public function integration(int $id): void {
        $program = Database::query(
            "SELECT * FROM programs WHERE id = ? AND status = 'active' LIMIT 1",
            [$id]
        )->fetch();

        if (!$program) {
            $_SESSION['error'] = 'Program not found or inactive';
            header('Location: /admin/programs');
            exit;
        }

        // Get settings for the app URL
        $settings = Database::query("SELECT * FROM settings WHERE name = 'app_url' LIMIT 1")->fetch();

        $this->view('programs/integration', [
            'title' => 'Integration Guide - Numok',
            'program' => $program,
            'settings' => $settings
        ]);
    }

    public function update(int $id): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/programs');
            exit;
        }

        // First check if program exists
        $program = Database::query(
            "SELECT id FROM programs WHERE id = ? LIMIT 1",
            [$id]
        )->fetch();

        if (!$program) {
            $_SESSION['error'] = 'Program not found';
            header('Location: /admin/programs');
            exit;
        }

        // Prepare data for update
        $data = [
            'name' => $_POST['name'] ?? '',
            'description' => $_POST['description'] ?? '',
            'commission_type' => $_POST['commission_type'] ?? 'percentage',
            'commission_value' => floatval($_POST['commission_value'] ?? 0),
            'cookie_days' => intval($_POST['cookie_days'] ?? 30),
            'is_recurring' => isset($_POST['is_recurring']) ? 1 : 0,
            'reward_days' => intval($_POST['reward_days'] ?? 0),
            'landing_page' => $_POST['landing_page'] ?? '',
            'status' => $_POST['status'] ?? 'active'
        ];

        try {
            Database::transaction(function() use ($id, $data) {
                // Update program
                Database::update('programs', $data, 'id = ?', [$id]);
                
                // Get updated program data for script generation
                $program = Database::query(
                    "SELECT * FROM programs WHERE id = ?",
                    [$id]
                )->fetch();
                
                // Generate tracking script
                ProgramScriptGenerator::generate($program, $_SERVER['HTTP_HOST']);
            });

            $_SESSION['success'] = 'Program updated successfully.';
        } catch (\Exception $e) {
            error_log("Failed to update program: " . $e->getMessage());
            $_SESSION['error'] = 'Failed to update program. Please try again.';
        }

        header('Location: /admin/programs');
        exit;
    }

    public function delete(int $id): void {
        try {
            Database::query(
                "DELETE FROM programs WHERE id = ?",
                [$id]
            );
            $_SESSION['success'] = 'Program deleted successfully.';
        } catch (\Exception $e) {
            $_SESSION['error'] = 'Failed to delete program. Please try again.';
        }

        header('Location: /admin/programs');
        exit;
    }
}

================
File: src/Controllers/SettingsController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;
use Numok\Middleware\AuthMiddleware;

class SettingsController extends Controller {
    private string $stripeTestEndpoint = 'https://api.stripe.com/v1/customers';
    public function __construct() {
        AuthMiddleware::adminOnly();
    }

    public function index(): void {
        $settings = $this->getSettings();
        
        $this->view('settings/index', [
            'title' => 'Settings - Numok',
            'settings' => $settings,
            'success' => $_SESSION['settings_success'] ?? null,
            'error' => $_SESSION['settings_error'] ?? null
        ]);
        
        // Clear flash messages
        unset($_SESSION['settings_success'], $_SESSION['settings_error']);
    }

    public function update(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/settings');
            exit;
        }

        try {
            Database::transaction(function() {
                $settings = [
                    'app_name' => $_POST['app_name'] ?? 'Numok',
                    'partner_welcome_message' => $_POST['partner_welcome_message'] ?? '',
                    'stripe_secret_key' => $_POST['stripe_secret_key'] ?? '',
                    'stripe_webhook_secret' => $_POST['stripe_webhook_secret'] ?? ''
                ];

                foreach ($settings as $key => $value) {
                    Database::query(
                        "INSERT INTO settings (name, value) 
                         VALUES (?, ?) 
                         ON DUPLICATE KEY UPDATE value = VALUES(value)",
                        [$key, $value]
                    );
                }
            });

            $_SESSION['settings_success'] = 'Settings updated successfully.';
        } catch (\Exception $e) {
            $_SESSION['settings_error'] = 'Failed to update settings. Please try again.';
        }

        header('Location: /admin/settings');
        exit;
    }

    public function testConnection(): void {
        header('Content-Type: application/json');

        $settings = $this->getSettings();
        $response = ['success' => false, 'messages' => []];

        // Test Stripe API Key
        if (!empty($settings['stripe_secret_key'])) {
            $ch = curl_init($this->stripeTestEndpoint);
            curl_setopt_array($ch, [
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_HTTPHEADER => [
                    'Authorization: Bearer ' . $settings['stripe_secret_key'],
                    'Stripe-Version: 2023-10-16'
                ]
            ]);
            
            $result = curl_exec($ch);
            $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            curl_close($ch);

            if ($httpCode === 200) {
                $response['messages'][] = [
                    'type' => 'success',
                    'text' => 'Successfully connected to Stripe API'
                ];
                $response['success'] = true;
            } elseif ($httpCode === 401) {
                $response['messages'][] = [
                    'type' => 'error',
                    'text' => 'Invalid Stripe API key'
                ];
            } else {
                $response['messages'][] = [
                    'type' => 'error',
                    'text' => 'Could not connect to Stripe API'
                ];
            }
        } else {
            $response['messages'][] = [
                'type' => 'warning',
                'text' => 'Stripe API key not configured'
            ];
        }

        // Test Webhook Secret
        if (!empty($settings['stripe_webhook_secret'])) {
            // Create a test signature using the webhook secret
            $timestamp = time();
            $payload = json_encode(['type' => 'test']);
            $signature = hash_hmac('sha256', "{$timestamp}.{$payload}", $settings['stripe_webhook_secret']);
            
            if ($signature) {
                $response['messages'][] = [
                    'type' => 'success',
                    'text' => 'Webhook secret is properly formatted'
                ];
                if (!$response['success']) {
                    $response['success'] = true;
                }
            }
        } else {
            $response['messages'][] = [
                'type' => 'warning',
                'text' => 'Webhook secret not configured'
            ];
        }

        echo json_encode($response);
        exit;
    }

    private function getSettings(): array {
        $stmt = Database::query("SELECT name, value FROM settings");
        $settings = [];
        
        while ($row = $stmt->fetch()) {
            $settings[$row['name']] = $row['value'];
        }

        return $settings;
    }

    public function updateProfile(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header('Location: /admin/settings');
            exit;
        }
    
        $userId = $_SESSION['user_id'];
        $currentPassword = $_POST['current_password'] ?? '';
        $newEmail = filter_var($_POST['email'] ?? '', FILTER_VALIDATE_EMAIL);
        $newPassword = $_POST['new_password'] ?? '';
        $confirmPassword = $_POST['confirm_password'] ?? '';
    
        try {
            // Verify current user
            $user = Database::query(
                "SELECT * FROM users WHERE id = ? LIMIT 1",
                [$userId]
            )->fetch();
    
            if (!$user || !password_verify($currentPassword, $user['password'])) {
                $_SESSION['settings_error'] = 'Current password is incorrect';
                header('Location: /admin/settings');
                exit;
            }
    
            $updates = [];
            $params = [];
    
            // Handle email update
            if ($newEmail && $newEmail !== $user['email']) {
                // Check if email is already taken
                $existing = Database::query(
                    "SELECT id FROM users WHERE email = ? AND id != ? LIMIT 1",
                    [$newEmail, $userId]
                )->fetch();
    
                if ($existing) {
                    $_SESSION['settings_error'] = 'Email address is already in use';
                    header('Location: /admin/settings');
                    exit;
                }
    
                $updates[] = "email = ?";
                $params[] = $newEmail;
            }
    
            // Handle password update
            if ($newPassword) {
                if (strlen($newPassword) < 8) {
                    $_SESSION['settings_error'] = 'New password must be at least 8 characters long';
                    header('Location: /admin/settings');
                    exit;
                }
    
                if ($newPassword !== $confirmPassword) {
                    $_SESSION['settings_error'] = 'New passwords do not match';
                    header('Location: /admin/settings');
                    exit;
                }
    
                $updates[] = "password = ?";
                $params[] = password_hash($newPassword, PASSWORD_DEFAULT);
            }
    
            // If there are updates to make
            if (!empty($updates)) {
                $params[] = $userId;
                Database::query(
                    "UPDATE users SET " . implode(', ', $updates) . " WHERE id = ?",
                    $params
                );
    
                // Update session if email changed
                if ($newEmail && $newEmail !== $user['email']) {
                    $_SESSION['user_email'] = $newEmail;
                }
    
                $_SESSION['settings_success'] = 'Profile updated successfully';
            }
    
        } catch (\Exception $e) {
            error_log("Profile update error: " . $e->getMessage());
            $_SESSION['settings_error'] = 'Failed to update profile. Please try again.';
        }
    
        header('Location: /admin/settings');
        exit;
    }
}

================
File: src/Controllers/TrackingController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;

class TrackingController extends Controller {
    public function script(int $programId): void {
        // Get program
        $program = Database::query(
            "SELECT * FROM programs WHERE id = ? AND status = 'active' LIMIT 1",
            [$programId]
        )->fetch();

        if (!$program) {
            header("HTTP/1.0 404 Not Found");
            echo "Program not found or inactive";
            exit;
        }

        // Set JavaScript content type
        header('Content-Type: application/javascript');
        
        // Set CORS headers to allow the script to be loaded from any domain
        header('Access-Control-Allow-Origin: *');
        header('Access-Control-Allow-Methods: GET');
        
        // Cache control - might want to adjust this in production
        header('Cache-Control: public, max-age=3600'); // 1 hour cache
        header('Vary: Origin');

        // Get the script content
        $scriptPath = ROOT_PATH . '/public/assets/js/numok-tracking.js';
        if (!file_exists($scriptPath)) {
            header("HTTP/1.0 500 Internal Server Error");
            echo "Tracking script not found";
            exit;
        }

        // Output the script with program ID
        echo sprintf("const NUMOK_PROGRAM_ID = %d;\n", $programId);
        echo sprintf("const NUMOK_BASE_URL = '%s';\n", rtrim($settings['app_url'] ?? '', '/'));
        echo file_get_contents($scriptPath);
    }

    public function config(int $programId): void {
        // Get program settings
        $program = Database::query(
            "SELECT cookie_days FROM programs WHERE id = ? AND status = 'active' LIMIT 1",
            [$programId]
        )->fetch();

        if (!$program) {
            header("HTTP/1.0 404 Not Found");
            exit;
        }

        // Get tracking settings
        $settings = Database::query(
            "SELECT value FROM settings WHERE name = 'click_tracking_enabled'"
        )->fetch();

        // Format settings
        $config = [
            'cookie_days' => (int)$program['cookie_days'],
            'track_clicks' => !empty($settings['value'])
        ];

        // Return JSON response
        header('Content-Type: application/json');
        echo json_encode($config);
    }

    public function click(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header("HTTP/1.0 405 Method Not Allowed");
            exit;
        }

        $data = json_decode(file_get_contents('php://input'), true);

        // Get partner_program_id from tracking code
        $partnerProgram = Database::query(
            "SELECT id FROM partner_programs WHERE tracking_code = ? LIMIT 1",
            [$data['tracking_code']]
        )->fetch();

        if (!$partnerProgram) {
            header("HTTP/1.0 400 Bad Request");
            exit;
        }

        try {
            // Generate unique click ID
            $clickId = bin2hex(random_bytes(16));

            // Prepare sub_ids JSON
            $subIds = array_filter([
                'sid' => $data['sid'] ?? null,
                'sid2' => $data['sid2'] ?? null,
                'sid3' => $data['sid3'] ?? null
            ]);

            Database::insert('clicks', [
                'partner_program_id' => $partnerProgram['id'],
                'click_id' => $clickId,
                'ip_address' => $_SERVER['REMOTE_ADDR'],
                'user_agent' => $_SERVER['HTTP_USER_AGENT'] ?? null,
                'referer' => $data['referrer'] ?? null,
                'sub_ids' => !empty($subIds) ? json_encode($subIds) : null
            ]);

            header("HTTP/1.1 201 Created");
        } catch (\Exception $e) {
            error_log("Click tracking error: " . $e->getMessage());
            header("HTTP/1.0 500 Internal Server Error");
        }
    }

    public function impression(): void {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            header("HTTP/1.0 405 Method Not Allowed");
            exit;
        }

        $data = json_decode(file_get_contents('php://input'), true);

        // Validate required fields
        if (!isset($data['program_id'], $data['tracking_code'], $data['url'])) {
            header("HTTP/1.0 400 Bad Request");
            exit;
        }

        try {
            Database::insert('impressions', [
                'program_id' => $data['program_id'],
                'tracking_code' => $data['tracking_code'],
                'url' => $data['url'],
                'ip_address' => $_SERVER['REMOTE_ADDR'],
                'user_agent' => $_SERVER['HTTP_USER_AGENT'] ?? null
            ]);

            header("HTTP/1.1 201 Created");
        } catch (\Exception $e) {
            header("HTTP/1.0 500 Internal Server Error");
        }
    }
}

================
File: src/Controllers/WebhookController.php
================
<?php

namespace Numok\Controllers;

use Numok\Database\Database;

class WebhookController extends Controller {
    public function stripeWebhook(): void {

        // Log the raw payload
        $payload = @file_get_contents('php://input');
        $this->logEvent('webhook_received', [
            'payload' => $payload,
            'signature' => $_SERVER['HTTP_STRIPE_SIGNATURE'] ?? null
        ]);
        
        // Get webhook secret from settings
        $webhookSecret = Database::query(
            "SELECT value FROM settings WHERE name = 'stripe_webhook_secret' LIMIT 1"
        )->fetch()['value'];

        // Get payload and signature
        $payload = @file_get_contents('php://input');
        $sigHeader = $_SERVER['HTTP_STRIPE_SIGNATURE'] ?? '';

        try {
            // Verify signature
            $event = \Stripe\Webhook::constructEvent(
                $payload, $sigHeader, $webhookSecret
            );

            // Process different event types
            switch ($event->type) {
                case 'checkout.session.completed':
                    $this->handleCheckoutCompleted($event->data->object);
                    break;
                    
                case 'payment_intent.succeeded':
                    $this->handlePaymentSucceeded($event->data->object);
                    break;

                case 'invoice.paid':
                    $this->handleInvoicePaid($event->data->object);
                    break;
            }

            http_response_code(200);
        } catch(\UnexpectedValueException $e) {
            // Invalid payload
            error_log('Stripe Webhook Error: ' . $e->getMessage());
            http_response_code(400);
            exit();
        } catch(\Stripe\Exception\SignatureVerificationException $e) {
            // Invalid signature
            error_log('Stripe Signature Error: ' . $e->getMessage());
            http_response_code(400);
            exit();
        } catch (\Exception $e) {
            $this->logEvent('webhook_error', [
                'error' => $e->getMessage(),
                'trace' => $e->getTraceAsString()
            ]);
            throw $e;
        }
    }

    private function handleCheckoutCompleted($session): void {
        $metadata = $session->metadata ?? new \stdClass();
        $trackingCode = $metadata->numok_tracking_code ?? null;

        if (!$trackingCode) {
            $this->logEvent('checkout_completed_no_tracking', $session);
            return;
        }

        // Get partner program
        $partnerProgram = Database::query(
            "SELECT pp.*, p.reward_days, p.is_recurring 
             FROM partner_programs pp
             JOIN programs p ON pp.program_id = p.id
             WHERE pp.tracking_code = ? 
             AND pp.status = 'active'
             AND p.status = 'active'
             LIMIT 1",
            [$trackingCode]
        )->fetch();

        if (!$partnerProgram) {
            $this->logEvent('checkout_completed_invalid_tracking', $session);
            return;
        }

        // Calculate commission status
        $status = $partnerProgram['reward_days'] > 0 ? 'pending' : 'payable';

        // Store conversion
        try {
            Database::insert('conversions', [
                'partner_program_id' => $partnerProgram['id'],
                'stripe_payment_id' => $session->payment_intent,
                'amount' => $session->amount_total / 100, // Convert from cents
                'commission_amount' => $this->calculateCommission($session->amount_total / 100, $partnerProgram),
                'status' => $status,
                'customer_email' => $session->customer_details->email ?? null,
                'metadata' => json_encode([
                    'sid' => $metadata->numok_sid ?? null,
                    'sid2' => $metadata->numok_sid2 ?? null,
                    'sid3' => $metadata->numok_sid3 ?? null
                ])
            ]);

            $this->logEvent('conversion_created', [
                'payment_id' => $session->payment_intent,
                'tracking_code' => $trackingCode,
                'amount' => $session->amount_total / 100
            ]);
        } catch (\Exception $e) {
            $this->logEvent('conversion_creation_failed', [
                'error' => $e->getMessage(),
                'payment_id' => $session->payment_intent
            ]);
            throw $e;
        }
    }

    private function handlePaymentSucceeded($paymentIntent): void {
        // Add detailed logging
        $this->logEvent('payment_intent_processing', [
            'payment_id' => $paymentIntent->id,
            'amount' => $paymentIntent->amount,
            'metadata' => $paymentIntent->metadata
        ]);
    
        // Get tracking code from metadata
        $metadata = $paymentIntent->metadata ?? new \stdClass();
        $trackingCode = $metadata->numok_tracking_code ?? null;
    
        if (!$trackingCode) {
            $this->logEvent('payment_succeeded_no_tracking', $paymentIntent);
            return;
        }
    
        // Get partner program with detailed logging
        $partnerProgram = Database::query(
            "SELECT pp.*, p.reward_days, p.is_recurring, p.commission_type, p.commission_value
             FROM partner_programs pp
             JOIN programs p ON pp.program_id = p.id
             WHERE pp.tracking_code = ? 
             AND pp.status = 'active'
             AND p.status = 'active'
             LIMIT 1",
            [$trackingCode]
        )->fetch();
    
        if (!$partnerProgram) {
            $this->logEvent('payment_succeeded_invalid_tracking', [
                'payment_id' => $paymentIntent->id,
                'tracking_code' => $trackingCode
            ]);
            return;
        }
    
        // Log found partner program
        $this->logEvent('partner_program_found', [
            'payment_id' => $paymentIntent->id,
            'partner_program' => $partnerProgram
        ]);
    
        // Calculate amount in dollars
        $amount = $paymentIntent->amount / 100;
    
        // Calculate commission
        $commission = $this->calculateCommission($amount, $partnerProgram);
    
        // Determine status
        $status = $partnerProgram['reward_days'] > 0 ? 'pending' : 'payable';
    
        // Store conversion
        try {
            Database::insert('conversions', [
                'partner_program_id' => $partnerProgram['id'],
                'stripe_payment_id' => $paymentIntent->id,
                'amount' => $amount,
                'commission_amount' => $commission,
                'status' => $status,
                'customer_email' => $paymentIntent->receipt_email ?? null,
                'metadata' => json_encode([
                    'sid' => $metadata->numok_sid ?? null,
                    'sid2' => $metadata->numok_sid2 ?? null,
                    'sid3' => $metadata->numok_sid3 ?? null
                ])
            ]);
    
            $this->logEvent('conversion_created', [
                'payment_id' => $paymentIntent->id,
                'tracking_code' => $trackingCode,
                'amount' => $amount,
                'commission' => $commission
            ]);
        } catch (\Exception $e) {
            $this->logEvent('conversion_creation_failed', [
                'error' => $e->getMessage(),
                'payment_id' => $paymentIntent->id,
                'stack_trace' => $e->getTraceAsString()
            ]);
            throw $e;
        }
    }

    private function handleInvoicePaid($invoice): void {
        // Add initial logging
        $this->logEvent('invoice_paid_processing', [
            'invoice_id' => $invoice->id,
            'subscription_id' => $invoice->subscription,
            'amount' => $invoice->amount_paid,
            'subscription_metadata' => $invoice->subscription_details->metadata ?? null
        ]);
    
        // Get tracking code from subscription metadata
        $metadata = $invoice->subscription_details->metadata ?? new \stdClass();
        $trackingCode = $metadata->numok_tracking_code ?? null;
    
        // If no tracking code in subscription metadata, try line items
        if (!$trackingCode && !empty($invoice->lines->data)) {
            $lineMetadata = $invoice->lines->data[0]->metadata ?? new \stdClass();
            $trackingCode = $lineMetadata->numok_tracking_code ?? null;
        }
    
        if (!$trackingCode) {
            $this->logEvent('invoice_paid_no_tracking', $invoice);
            return;
        }
    
        // Get partner program
        $partnerProgram = Database::query(
            "SELECT pp.*, p.reward_days, p.is_recurring, p.commission_type, p.commission_value 
             FROM partner_programs pp
             JOIN programs p ON pp.program_id = p.id
             WHERE pp.tracking_code = ? 
             AND pp.status = 'active'
             AND p.status = 'active'
             LIMIT 1",
            [$trackingCode]
        )->fetch();
    
        if (!$partnerProgram) {
            $this->logEvent('invoice_paid_invalid_tracking', [
                'invoice_id' => $invoice->id,
                'tracking_code' => $trackingCode
            ]);
            return;
        }
    
        if (!$partnerProgram['is_recurring']) {
            $this->logEvent('invoice_paid_no_recurring', [
                'invoice_id' => $invoice->id,
                'partner_program' => $partnerProgram
            ]);
            return;
        }
    
        // Calculate amount in dollars
        $amount = $invoice->amount_paid / 100;
    
        // Calculate commission
        $commission = $this->calculateCommission($amount, $partnerProgram);
    
        // Determine status
        $status = $partnerProgram['reward_days'] > 0 ? 'pending' : 'payable';
    
        try {
            // Create conversion for the subscription payment
            Database::insert('conversions', [
                'partner_program_id' => $partnerProgram['id'],
                'stripe_payment_id' => $invoice->payment_intent,
                'amount' => $amount,
                'commission_amount' => $commission,
                'status' => $status,
                'customer_email' => $invoice->customer_email ?? null,
                'metadata' => json_encode([
                    'sid' => $metadata->numok_sid ?? null,
                    'sid2' => $metadata->numok_sid2 ?? null,
                    'sid3' => $metadata->numok_sid3 ?? null,
                    'subscription_id' => $invoice->subscription
                ])
            ]);
    
            $this->logEvent('subscription_conversion_created', [
                'invoice_id' => $invoice->id,
                'tracking_code' => $trackingCode,
                'amount' => $amount,
                'commission' => $commission,
                'subscription_id' => $invoice->subscription
            ]);
        } catch (\Exception $e) {
            $this->logEvent('subscription_conversion_failed', [
                'error' => $e->getMessage(),
                'invoice_id' => $invoice->id,
                'stack_trace' => $e->getTraceAsString()
            ]);
            throw $e;
        }
    }

    private function calculateCommission(float $amount, array $partnerProgram): float {
        if ($partnerProgram['commission_type'] === 'percentage') {
            return round($amount * ($partnerProgram['commission_value'] / 100), 2);
        }
        return $partnerProgram['commission_value'];
    }

    private function logEvent(string $type, $data): void {
        Database::insert('logs', [
            'type' => $type,
            'message' => is_string($data) ? $data : json_encode($data),
            'context' => is_string($data) ? null : json_encode($data)
        ]);
    }
}

================
File: src/Database/Database.php
================
<?php

namespace Numok\Database;

use PDO;
use PDOException;

class Database {
    private static ?PDO $instance = null;
    private static array $config = [];

    private function __construct() {}
    private function __clone() {}

    public static function setConfig(array $config): void {
        self::$config = $config;
    }

    public static function getInstance(): PDO {
        if (self::$instance === null) {
            try {
                $dsn = sprintf(
                    "mysql:host=%s;dbname=%s;charset=utf8mb4",
                    self::$config['host'],
                    self::$config['database']
                );

                $options = [
                    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                    PDO::ATTR_EMULATE_PREPARES => false,
                    PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci"
                ];

                self::$instance = new PDO(
                    $dsn,
                    self::$config['username'],
                    self::$config['password'],
                    $options
                );
            } catch (PDOException $e) {
                // Log the error securely without exposing credentials
                error_log("Database connection failed: " . $e->getMessage());
                throw new PDOException("Database connection failed. Please check your configuration.");
            }
        }

        return self::$instance;
    }

    public static function query(string $sql, array $params = []): \PDOStatement {
        try {
            $stmt = self::getInstance()->prepare($sql);
            $stmt->execute($params);
            return $stmt;
        } catch (PDOException $e) {
            error_log("Query failed: " . $e->getMessage() . " SQL: " . $sql);
            throw new PDOException("Database query failed.");
        }
    }

    public static function insert(string $table, array $data): int {
        $fields = array_keys($data);
        $placeholders = array_fill(0, count($fields), '?');
        
        $sql = sprintf(
            "INSERT INTO %s (%s) VALUES (%s)",
            $table,
            implode(', ', $fields),
            implode(', ', $placeholders)
        );

        self::query($sql, array_values($data));
        return (int) self::getInstance()->lastInsertId();
    }

    public static function update(string $table, array $data, string $where, array $whereParams = []): int {
        $fields = array_map(fn($field) => "$field = ?", array_keys($data));
        
        $sql = sprintf(
            "UPDATE %s SET %s WHERE %s",
            $table,
            implode(', ', $fields),
            $where
        );

        $stmt = self::query($sql, [...array_values($data), ...$whereParams]);
        return $stmt->rowCount();
    }

    public static function delete(string $table, string $where, array $whereParams = []): int {
        $sql = sprintf("DELETE FROM %s WHERE %s", $table, $where);
        $stmt = self::query($sql, $whereParams);
        return $stmt->rowCount();
    }

    public static function transaction(callable $callback): mixed {
        $pdo = self::getInstance();
        
        try {
            $pdo->beginTransaction();
            $result = $callback($pdo);
            $pdo->commit();
            return $result;
        } catch (\Exception $e) {
            $pdo->rollBack();
            throw $e;
        }
    }
}

================
File: src/Middleware/AuthMiddleware.php
================
<?php

namespace Numok\Middleware;

class AuthMiddleware {
    public static function handle(): void {
        // Start session if not already started
        if (session_status() === PHP_SESSION_NONE) {
            session_start();
        }

        // Check if user is logged in
        if (!isset($_SESSION['user_id'])) {
            header('Location: /admin/login');
            exit;
        }
    }

    public static function adminOnly(): void {
        self::handle();
        
        // Check if user is admin
        if (!($_SESSION['is_admin'] ?? false)) {
            header('Location: /admin/dashboard');
            exit;
        }
    }
}

================
File: src/Middleware/PartnerMiddleware.php
================
<?php

namespace Numok\Middleware;

class PartnerMiddleware {
    public static function handle(): void {
        // Start session if not already started
        if (session_status() === PHP_SESSION_NONE) {
            session_start();
        }

        // Check if partner is logged in
        if (!isset($_SESSION['partner_id'])) {
            header('Location: /login');
            exit;
        }

        // Check if partner's status is active by querying the database
        $partner = \Numok\Database\Database::query(
            "SELECT status FROM partners WHERE id = ? LIMIT 1",
            [$_SESSION['partner_id']]
        )->fetch();

        if (!$partner || $partner['status'] !== 'active') {
            // Clear session and redirect
            $_SESSION = [];
            if (isset($_COOKIE[session_name()])) {
                setcookie(session_name(), '', time() - 3600, '/');
            }
            session_destroy();
            
            header('Location: /login');
            exit;
        }
    }
}

================
File: src/Services/ProgramScriptGenerator.php
================
<?php

namespace Numok\Services;

class ProgramScriptGenerator {
    public static function generate(array $program, string $domain): bool {
        // Ensure domain doesn't end with a slash
        $domain = rtrim($domain, '/');
        
        $script = <<<JAVASCRIPT
(function() {
    const COOKIE_NAME = 'numok_tracking';
    const COOKIE_DAYS = {$program['cookie_days']};
    const PROGRAM_ID = {$program['id']};
    const API_DOMAIN = '{$domain}';

    class NumokTracker {
        constructor() {
            this.init();
        }

        init() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('via')) {
                const trackingData = {
                    tracking_code: urlParams.get('via'),
                    sid: urlParams.get('sid') || null,
                    sid2: urlParams.get('sid2') || null,
                    sid3: urlParams.get('sid3') || null,
                    referrer: document.referrer || null,
                    timestamp: new Date().toISOString()
                };

                this.saveTrackingData(trackingData);
            }
        }

        saveTrackingData(data) {
            const expires = new Date();
            expires.setDate(expires.getDate() + COOKIE_DAYS);
            document.cookie = `\${COOKIE_NAME}=\${JSON.stringify(data)};expires=\${expires.toUTCString()};path=/`;
            this.trackClick(data).catch(console.error);
        }

        async trackClick(data) {
            try {
                const trackingEnabled = await this.checkTrackingEnabled();
                if (!trackingEnabled) return;

                await fetch(`https://\${API_DOMAIN}/api/tracking/click`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                console.error('Click tracking failed:', error);
            }
        }

        async checkTrackingEnabled() {
            try {
                const response = await fetch(`https://\${API_DOMAIN}/api/tracking/config/\${PROGRAM_ID}`);
                const config = await response.json();
                return config.track_clicks || false;
            } catch {
                return false;
            }
        }

        getStripeMetadata() {
            const data = this.getTrackingData();
            if (!data) return {};

            return {
                numok_tracking_code: data.tracking_code,
                ...data.sid && { numok_sid: data.sid },
                ...data.sid2 && { numok_sid2: data.sid2 },
                ...data.sid3 && { numok_sid3: data.sid3 }
            };
        }

        getTrackingData() {
            const cookie = this.getCookie(COOKIE_NAME);
            if (!cookie) return null;

            try {
                return JSON.parse(cookie);
            } catch {
                return null;
            }
        }

        getCookie(name) {
            const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
            return match ? match[2] : null;
        }

        hasTracking() {
            return !!this.getTrackingData();
        }
    }

    window.numok = new NumokTracker();
})();
JAVASCRIPT;

        $minified = self::minifyJS($script);

        $dir = ROOT_PATH . '/public/tracking';
        if (!is_dir($dir)) {
            mkdir($dir, 0755, true);
        }

        return file_put_contents("{$dir}/program-{$program['id']}.js", $minified) !== false;
    }

    private static function minifyJS(string $js): string {
        $js = preg_replace('!/\*[^*]*\*+([^/][^*]*\*+)*/!', '', $js);
        $js = str_replace(["\r\n", "\r", "\n", "\t"], '', $js);
        $js = preg_replace('/\s+/', ' ', $js);
        return trim($js);
    }
}

================
File: src/Views/auth/login.php
================
<div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-sm">
        <h2 class="mt-10 text-center text-2xl font-bold leading-9 tracking-tight text-gray-900">
            <img src="/assets/images/numok-logo.png" class="h-12 mx-auto">
        </h2>
    </div>

    <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
        <?php if (!empty($error)): ?>
            <div class="rounded-md bg-red-50 p-4 mb-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-red-700"><?= htmlspecialchars($error) ?></p>
                    </div>
                </div>
            </div>
        <?php endif; ?>

        <form class="space-y-6" action="/admin/auth/login" method="POST">
            <div>
                <label for="email" class="block text-sm font-medium leading-6 text-gray-900">
                    Email address
                </label>
                <div class="mt-2">
                    <input id="email" name="email" type="email" autocomplete="email" required autofocus
                    <?php if ($_SERVER['HTTP_HOST']=='demo.numok.com') { echo ' value="admin@numok.com"'; } /* This is for demo purposes */ ?>
                           class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                </div>
            </div>

            <div>
                <label for="password" class="block text-sm font-medium leading-6 text-gray-900">
                    Password
                </label>
                <div class="mt-2">
                    <input id="password" name="password" type="password" autocomplete="current-password" required
                    <?php if ($_SERVER['HTTP_HOST']=='demo.numok.com') { echo ' value="admin123"'; } /* This is for demo purposes */ ?>
                           class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                </div>
            </div>

            <div>
                <button type="submit" 
                        class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    Sign in
                </button>
            </div>
        </form>
    </div>
</div>

================
File: src/Views/conversions/index.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="sm:flex sm:items-center">
            <div class="sm:flex-auto">
                <h1 class="text-2xl font-semibold text-gray-900">Conversions</h1>
                <p class="mt-2 text-sm text-gray-700">A list of all conversions from your affiliate programs.</p>
            </div>
            <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
                <a href="/admin/conversions/export" class="block rounded-md bg-white px-3 py-2 text-center text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    Export CSV
                </a>
            </div>
        </div>

        <!-- Filter Form -->
        <form method="GET" action="/admin/conversions" class="mt-8 flex items-center gap-4">
            <div class="flex-1">
                <select id="status" name="status" class="block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    <option value="all" <?= ($filters['status'] ?? 'all') === 'all' ? 'selected' : '' ?>>All Status</option>
                    <option value="pending" <?= ($filters['status'] ?? '') === 'pending' ? 'selected' : '' ?>>Pending</option>
                    <option value="payable" <?= ($filters['status'] ?? '') === 'payable' ? 'selected' : '' ?>>Payable</option>
                    <option value="paid" <?= ($filters['status'] ?? '') === 'paid' ? 'selected' : '' ?>>Paid</option>
                    <option value="rejected" <?= ($filters['status'] ?? '') === 'rejected' ? 'selected' : '' ?>>Rejected</option>
                </select>
            </div>

            <div class="flex-1">
                <select id="partner_id" name="partner_id" class="block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    <option value="">All Partners</option>
                    <?php foreach ($partners as $partner): ?>
                        <option value="<?= $partner['id'] ?>" <?= ($filters['partner_id'] ?? '') == $partner['id'] ? 'selected' : '' ?>>
                            <?= htmlspecialchars($partner['company_name'] ?? '') ?>
                        </option>
                    <?php endforeach; ?>
                </select>
            </div>

            <div class="flex-1">
                <select id="program_id" name="program_id" class="block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    <option value="">All Programs</option>
                    <?php foreach ($programs as $program): ?>
                        <option value="<?= $program['id'] ?>" <?= ($filters['program_id'] ?? '') == $program['id'] ? 'selected' : '' ?>>
                            <?= htmlspecialchars($program['name'] ?? '') ?>
                        </option>
                    <?php endforeach; ?>
                </select>
            </div>

            <div class="flex items-center gap-2">
                <input type="date" name="start_date" id="start_date"
                    value="<?= htmlspecialchars($filters['start_date'] ?? '') ?>"
                    placeholder="Start Date"
                    class="block w-40 rounded-md border-0 py-1.5 pl-3 pr-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                <span class="text-gray-500">-</span>
                <input type="date" name="end_date" id="end_date"
                    value="<?= htmlspecialchars($filters['end_date'] ?? '') ?>"
                    placeholder="End Date"
                    class="block w-40 rounded-md border-0 py-1.5 pl-3 pr-3 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
            </div>

            <button type="submit" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500">
                Apply Filters
            </button>
        </form>

        <!-- Stats Overview -->
        <dl class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-3">
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Conversions</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900"><?= number_format($totals['count']) ?></dd>
            </div>
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Revenue</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">$<?= number_format($totals['amount'], 2) ?></dd>
            </div>
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Commission</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">$<?= number_format($totals['commission'], 2) ?></dd>
            </div>
        </dl>

        <!-- Conversions Table -->
        <?php if (empty($conversions)): ?>
            <div class="mt-8 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No conversions found</h3>
                <p class="mt-1 text-sm text-gray-500">No conversions match your current filters.</p>
            </div>
        <?php else: ?>
            <div class="mt-8 flow-root">
                <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle">
                        <table class="min-w-full divide-y divide-gray-300">
                            <thead>
                                <tr>
                                    <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Date</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Partner</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Program</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Customer</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Amount</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Commission</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                    <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                                        <span class="sr-only">Actions</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 bg-white">
                                <?php foreach ($conversions as $conversion): ?>
                                    <tr>
                                        <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-900 sm:pl-6">
                                            <?= date('M j, Y', strtotime($conversion['created_at'] ?? '')) ?>
                                            <div class="text-gray-500"><?= date('g:i A', strtotime($conversion['created_at'] ?? '')) ?></div>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm">
                                            <div class="font-medium text-gray-900"><?= htmlspecialchars($conversion['partner_name'] ?? '') ?></div>
                                            <div class="text-gray-500 font-mono text-xs"><?= htmlspecialchars($conversion['tracking_code'] ?? '') ?></div>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            <?= htmlspecialchars($conversion['program_name'] ?? '') ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            <?= htmlspecialchars($conversion['customer_email'] ?? '') ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($conversion['amount'] ?? 0, 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($conversion['commission_amount'] ?? 0, 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm">
                                            <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium <?php
                                                                                                                            switch ($conversion['status']):
                                                                                                                                case 'pending':
                                                                                                                                    echo 'bg-yellow-50 text-yellow-800';
                                                                                                                                    break;
                                                                                                                                case 'payable':
                                                                                                                                    echo 'bg-green-50 text-green-800';
                                                                                                                                    break;
                                                                                                                                case 'paid':
                                                                                                                                    echo 'bg-blue-50 text-blue-800';
                                                                                                                                    break;
                                                                                                                                case 'rejected':
                                                                                                                                    echo 'bg-red-50 text-red-800';
                                                                                                                                    break;
                                                                                                                                default:
                                                                                                                                    echo 'bg-gray-100 text-gray-800';
                                                                                                                            endswitch; ?>">
                                                <?= ucfirst(htmlspecialchars($conversion['status'])) ?>
                                            </span>
                                        </td>
                                        <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-sm font-medium sm:pr-6">
                                            <div class="flex items-center justify-end space-x-2">
                                                <?php if ($conversion['status'] === 'pending'): ?>
                                                    <!-- Mark as Payable -->
                                                    <form method="POST" action="/admin/conversions/update-status" class="inline-block">
                                                        <input type="hidden" name="id" value="<?= $conversion['id'] ?>">
                                                        <input type="hidden" name="status" value="payable">
                                                        <button type="submit"
                                                            class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-green-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-green-50">
                                                            <svg class="mr-1.5 h-4 w-4 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                                            </svg>
                                                            Mark Payable
                                                        </button>
                                                    </form>

                                                    <!-- Reject -->
                                                    <form method="POST" action="/admin/conversions/update-status" class="inline-block">
                                                        <input type="hidden" name="id" value="<?= $conversion['id'] ?>">
                                                        <input type="hidden" name="status" value="rejected">
                                                        <button type="submit"
                                                            class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-red-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-red-50">
                                                            <svg class="mr-1.5 h-4 w-4 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                                                            </svg>
                                                            Reject
                                                        </button>
                                                    </form>
                                                <?php endif; ?>

                                                <?php if ($conversion['status'] === 'payable'): ?>
                                                    <!-- Mark as Paid -->
                                                    <form method="POST" action="/admin/conversions/update-status" class="inline-block">
                                                        <input type="hidden" name="id" value="<?= $conversion['id'] ?>">
                                                        <input type="hidden" name="status" value="paid">
                                                        <button type="submit"
                                                            class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-blue-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-blue-50">
                                                            <svg class="mr-1.5 h-4 w-4 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z" clip-rule="evenodd" />
                                                            </svg>
                                                            Mark Paid
                                                        </button>
                                                    </form>
                                                <?php endif; ?>

                                                <!-- View Details button (if needed in the future) -->
                                                <!-- <a href="#" class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                                                    <svg class="mr-1.5 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                                    </svg>
                                                    View Details
                                                </a> -->
                                            </div>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        <?php endif; ?>
    </div>
</div>

================
File: src/Views/dashboard/index.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-semibold text-gray-900">Dashboard</h1>
    </div>
    <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <!-- Stats -->
        <div class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
            <!-- Total Partners -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Total Partners</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900"><?= $stats['total_partners'] ?? 0 ?></dd>
            </div>
            <!-- Total Programs -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">Active Programs</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900"><?= $stats['active_programs'] ?? 0 ?></dd>
            </div>
            <!-- Monthly Revenue -->
            <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
                <dt class="truncate text-sm font-medium text-gray-500">This Month's Revenue</dt>
                <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">$<?= number_format($stats['monthly_revenue'] ?? 0, 2) ?></dd>
            </div>
        </div>

        <!-- Recent Conversions -->
        <div class="mt-8">
            <div class="sm:flex sm:items-center">
                <div class="sm:flex-auto">
                    <h2 class="text-base font-semibold leading-6 text-gray-900">Recent Conversions</h2>
                    <p class="mt-2 text-sm text-gray-700">A list of recent conversions and their status.</p>
                </div>
                <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
                    <a href="/admin/conversions" class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-indigo-500">View all</a>
                </div>
            </div>
            <?php if (!empty($recent_conversions)): ?>
            <div class="mt-8 flow-root">
                <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
                        <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
                            <table class="min-w-full divide-y divide-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Partner</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Amount</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Commission</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Date</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 bg-white">
                                    <?php foreach ($recent_conversions as $conversion): ?>
                                    <tr>
                                        <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">
                                            <?= htmlspecialchars($conversion['partner_name']) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($conversion['amount'], 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($conversion['commission_amount'], 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm">
                                            <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium 
                                                <?php switch($conversion['status']):
                                                    case 'pending': echo 'bg-yellow-50 text-yellow-800'; break;
                                                    case 'payable': echo 'bg-green-50 text-green-800'; break;
                                                    case 'paid': echo 'bg-blue-50 text-blue-800'; break;
                                                    case 'rejected': echo 'bg-red-50 text-red-800'; break;
                                                endswitch; ?>">
                                                <?= ucfirst(htmlspecialchars($conversion['status'])) ?>
                                            </span>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            <?= date('M j, Y', strtotime($conversion['created_at'])) ?>
                                        </td>
                                    </tr>
                                    <?php endforeach; ?>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <?php else: ?>
            <div class="text-center mt-8">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No conversions</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by adding your first program.</p>
                <div class="mt-6">
                    <a href="/admin/programs/new" class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white hover:bg-indigo-500">
                        Create Program
                    </a>
                </div>
            </div>
            <?php endif; ?>
        </div>
    </div>
</div>

================
File: src/Views/layouts/footer.php
================
</div>
        </main>
        
        <?php if (isset($_SESSION['user_id'])): ?>
        <footer class="mt-auto">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="border-t border-gray-200 py-8">
                    <p class="text-center text-xs leading-5 text-gray-500">
                        <a href="https://numok.com">
                            <img src="/assets/images/numok-logo.png" alt="Numok" class="h-8 mx-auto" />
                        </a>
                    </p>
                </div>
            </div>
        </footer>
        <?php endif; ?>
    </div>
</body>
</html>

================
File: src/Views/layouts/header.php
================
<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= htmlspecialchars($title ?? 'Numok') ?></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
</head>
<body class="h-full">
    <?php if (isset($_SESSION['user_id'])): ?>
    <div class="min-h-full">
        <nav class="bg-white shadow">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 justify-between">
                    <div class="flex">
                        <div class="flex flex-shrink-0 items-center">
                            <a href="/admin">
                                <img src="/assets/images/numok-logo.png" alt="Numok" class="h-8" />
                            </a>
                        </div>
                        <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                            <a href="/admin/dashboard" class="<?= $path === 'dashboard' ? 'border-indigo-500 text-gray-900' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700' ?> inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium">Dashboard</a>
                            <a href="/admin/programs" class="<?= $path === 'programs' ? 'border-indigo-500 text-gray-900' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700' ?> inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium">Programs</a>
                            <a href="/admin/partners" class="<?= $path === 'partners' ? 'border-indigo-500 text-gray-900' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700' ?> inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium">Partners</a>
                            <a href="/admin/conversions" class="<?= $path === 'conversions' ? 'border-indigo-500 text-gray-900' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700' ?> inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium">Conversions</a>
                        </div>
                    </div>
                    
                    <div class="hidden sm:ml-6 sm:flex sm:items-center">
                        <!-- User dropdown -->
                        <div class="relative ml-3" x-data="{ open: false }">
                            <div>
                                <button @click="open = !open" type="button" class="flex rounded-full bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" id="user-menu-button">
                                    <span class="sr-only">Open user menu</span>
                                    <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-sm font-medium text-gray-600"><?= strtoupper(substr($_SESSION['user_name'] ?? 'U', 0, 1)) ?></span>
                                    </div>
                                </button>
                            </div>

                            <div x-show="open" 
                                 @click.away="open = false"
                                 class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" 
                                 role="menu" 
                                 aria-orientation="vertical" 
                                 aria-labelledby="user-menu-button" 
                                 tabindex="-1"
                                 style="display: none;">
                                <div class="block px-4 py-2 text-xs text-gray-400">
                                    Signed in as<br>
                                    <strong class="text-gray-900"><?= htmlspecialchars($_SESSION['user_name'] ?? '') ?></strong>
                                </div>
                                <div class="border-t border-gray-100"></div>
                                <a href="/admin/settings" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Settings</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="/admin/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Sign out</a>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile menu button -->
                    <div class="flex items-center sm:hidden">
                        <button type="button" @click="mobileMenuOpen = !mobileMenuOpen" class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <span class="sr-only">Open main menu</span>
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile menu -->
            <div class="sm:hidden" x-data="{ mobileMenuOpen: false }" x-show="mobileMenuOpen" style="display: none;">
                <div class="space-y-1 pb-3 pt-2">
                    <a href="/admin/dashboard" class="<?= $path === 'dashboard' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700' ?> block border-l-4 py-2 pl-3 pr-4 text-base font-medium">Dashboard</a>
                    <a href="/admin/programs" class="<?= $path === 'programs' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700' ?> block border-l-4 py-2 pl-3 pr-4 text-base font-medium">Programs</a>
                    <a href="/admin/partners" class="<?= $path === 'partners' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700' ?> block border-l-4 py-2 pl-3 pr-4 text-base font-medium">Partners</a>
                    <a href="/admin/conversions" class="<?= $path === 'conversions' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700' ?> block border-l-4 py-2 pl-3 pr-4 text-base font-medium">Conversions</a>
                </div>
                <div class="border-t border-gray-200 pb-3 pt-4">
                    <div class="flex items-center px-4">
                        <div class="flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                                <span class="text-sm font-medium text-gray-600"><?= strtoupper(substr($_SESSION['user_name'] ?? 'U', 0, 1)) ?></span>
                            </div>
                        </div>
                        <div class="ml-3">
                            <div class="text-base font-medium text-gray-800"><?= htmlspecialchars($_SESSION['user_name'] ?? '') ?></div>
                            <div class="text-sm font-medium text-gray-500"><?= htmlspecialchars($_SESSION['user_email'] ?? '') ?></div>
                        </div>
                    </div>
                    <div class="mt-3 space-y-1">
                        <a href="/admin/settings" class="block px-4 py-2 text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-800">Settings</a>
                        <a href="/admin/logout" class="block px-4 py-2 text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-800">Sign out</a>
                    </div>
                </div>
            </div>
        </nav>

        <main>
            <div class="mx-auto max-w-7xl py-6 sm:px-6 lg:px-8">
    <?php else: ?>
        <main>
    <?php endif; ?>

================
File: src/Views/partner/auth/login.php
================
<div class="min-h-screen flex flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <img src="/assets/images/numok-logo.png" alt="Numok" class="h-12 mx-auto" />
        <h2 class="mt-2 text-center text-gray-400">
            Partner login
        </h2>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <?php if (!empty($error)): ?>
            <div class="rounded-md bg-red-50 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($error) ?></p>
                    </div>
                </div>
            </div>
            <?php endif; ?>

            <?php if (isset($_SESSION['register_success'])): ?>
            <div class="rounded-md bg-green-50 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($_SESSION['register_success']) ?></p>
                    </div>
                </div>
            </div>
            <?php unset($_SESSION['register_success']); endif; ?>

            <form class="space-y-6" action="/auth/login" method="POST">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">
                        Email address
                    </label>
                    <div class="mt-1">
                        <input id="email" name="email" type="email" autocomplete="email" required autofocus
                        <?php if ($_SERVER['HTTP_HOST']=='demo.numok.com') { echo ' value="partner@numok.com"'; } /* This is for demo purposes */ ?>
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">
                        Password
                    </label>
                    <div class="mt-1">
                        <input id="password" name="password" type="password" autocomplete="current-password" required
                        <?php if ($_SERVER['HTTP_HOST']=='demo.numok.com') { echo ' value="partner123"'; } /* This is for demo purposes */ ?>
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox"
                               class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-900">
                            Remember me
                        </label>
                    </div>

                    <div class="text-sm">
                        <a href="#" class="font-medium text-indigo-600 hover:text-indigo-500">
                            Forgot your password?
                        </a>
                    </div>
                </div>

                <div>
                    <button type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Sign in
                    </button>
                </div>
            </form>
            
        </div>
        <p class="mt-8 text-center text-sm text-gray-600">
            Or
            <a href="/register" class="font-medium text-indigo-600 hover:text-indigo-500">
                register for a new account
            </a>
        </p>
    </div>
</div>

================
File: src/Views/partner/auth/register.php
================
<div class="min-h-screen flex flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
    <img src="/assets/images/numok-logo.png" alt="Numok" class="h-12 mx-auto" />
        <h2 class="mt-2 text-center text-gray-400">
            Create your partner account
        </h2>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <?php if (isset($_SESSION['register_error'])): ?>
            <div class="rounded-md bg-red-50 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['register_error']) ?></p>
                    </div>
                </div>
            </div>
            <?php unset($_SESSION['register_error']); endif; ?>

            <form class="space-y-6" action="/auth/register" method="POST">
                <div>
                    <label for="company_name" class="block text-sm font-medium text-gray-700">
                        Company Name
                    </label>
                    <div class="mt-1">
                        <input id="company_name" name="company_name" type="text" required autofocus
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>

                <div>
                    <label for="contact_name" class="block text-sm font-medium text-gray-700">
                        Contact Name
                    </label>
                    <div class="mt-1">
                        <input id="contact_name" name="contact_name" type="text" required
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">
                        Email address
                    </label>
                    <div class="mt-1">
                        <input id="email" name="email" type="email" autocomplete="email" required
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">
                        Password
                    </label>
                    <div class="mt-1">
                        <input id="password" name="password" type="password" required
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                               minlength="8">
                    </div>
                </div>

                <div>
                    <button type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Create account
                    </button>
                </div>
            </form>
        </div>
        <p class="mt-8 text-center text-sm text-gray-600">
            Already registered?
            <a href="/login" class="font-medium text-indigo-600 hover:text-indigo-500">
                Sign in to your account
            </a>
        </p>
    </div>
</div>

================
File: src/Views/partner/dashboard/index.php
================
<?php
// File: src/Views/partner/dashboard/index.php
?>
<div class="py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-semibold text-gray-900">Dashboard</h1>

        <!-- Stats Overview -->
        <dl class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
            <!-- Monthly Earnings -->
            <div class="px-4 py-5 bg-white shadow rounded-lg overflow-hidden sm:p-6">
                <dt class="text-sm font-medium text-gray-500 truncate">Monthly Earnings</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900">
                    $<?= number_format($stats['monthly_commission'], 2) ?>
                </dd>
                <dd class="mt-1 text-sm text-gray-500">
                    From <?= number_format($stats['monthly_conversions']) ?> conversions
                </dd>
            </div>

            <!-- Total Earnings -->
            <div class="px-4 py-5 bg-white shadow rounded-lg overflow-hidden sm:p-6">
                <dt class="text-sm font-medium text-gray-500 truncate">Total Earnings</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900">
                    $<?= number_format($stats['total_commission'], 2) ?>
                </dd>
                <dd class="mt-1 text-sm text-gray-500">
                    From <?= number_format($stats['total_conversions']) ?> conversions
                </dd>
            </div>

            <!-- Active Programs -->
            <div class="px-4 py-5 bg-white shadow rounded-lg overflow-hidden sm:p-6">
                <dt class="text-sm font-medium text-gray-500 truncate">Active Programs</dt>
                <dd class="mt-1 text-3xl font-semibold text-gray-900">
                    <?= number_format($stats['active_programs']) ?>
                </dd>
            </div>
        </dl>

        <!-- Recent Conversions -->
        <div class="mt-8">
            <div class="sm:flex sm:items-center">
                <div class="sm:flex-auto">
                    <h2 class="text-xl font-semibold text-gray-900">Recent Conversions</h2>
                    <p class="mt-2 text-sm text-gray-700">A list of your most recent conversions across all programs.</p>
                </div>
            </div>
            
            <?php if (empty($conversions)): ?>
            <div class="text-center mt-6">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No conversions yet</h3>
                <p class="mt-1 text-sm text-gray-500">Start promoting your programs to earn commissions.</p>
            </div>
            <?php else: ?>
            <div class="mt-8 flex flex-col">
                <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
                        <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                            <table class="min-w-full divide-y divide-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Date</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Program</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Amount</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Commission</th>
                                        <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200 bg-white">
                                    <?php foreach ($conversions as $conversion): ?>
                                    <tr>
                                        <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-900 sm:pl-6">
                                            <?= date('M j, Y', strtotime($conversion['created_at'])) ?>
                                            <div class="text-gray-500"><?= date('g:i A', strtotime($conversion['created_at'])) ?></div>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            <div class="font-medium text-gray-900"><?= htmlspecialchars($conversion['program_name']) ?></div>
                                            <div class="text-gray-500 font-mono text-xs"><?= htmlspecialchars($conversion['tracking_code']) ?></div>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($conversion['amount'], 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($conversion['commission_amount'], 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm">
                                            <span class="inline-flex rounded-full px-2 text-xs font-semibold leading-5 <?php
                                                switch($conversion['status']) {
                                                    case 'pending':
                                                        echo 'bg-yellow-100 text-yellow-800';
                                                        break;
                                                    case 'payable':
                                                        echo 'bg-green-100 text-green-800';
                                                        break;
                                                    case 'paid':
                                                        echo 'bg-blue-100 text-blue-800';
                                                        break;
                                                    case 'rejected':
                                                        echo 'bg-red-100 text-red-800';
                                                        break;
                                                    default:
                                                        echo 'bg-gray-100 text-gray-800';
                                                }
                                            ?>">
                                                <?= ucfirst(htmlspecialchars($conversion['status'])) ?>
                                            </span>
                                        </td>
                                    </tr>
                                    <?php endforeach; ?>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <?php endif; ?>
        </div>
    </div>
</div>

================
File: src/Views/partner/layouts/footer.php
================
</div>
        </main>
        
        <?php if (isset($_SESSION['partner_id'])): ?>
        <footer class="mt-auto">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="border-t border-gray-200 py-8">
                    <p class="text-center text-xs leading-5 text-gray-500">
                        <a href="https://numok.com">
                            <img src="/assets/images/numok-logo.png" alt="Numok" class="h-8 mx-auto" />
                        </a>
                    </p>
                </div>
            </div>
        </footer>
        <?php endif; ?>
    </div>
</body>
</html>

================
File: src/Views/partner/layouts/header.php
================
<?php
// File: src/Views/layouts/header.php
?>
<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= htmlspecialchars($title ?? 'Partner Portal - Numok') ?></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
</head>
<body class="h-full">
    <?php if (isset($_SESSION['partner_id'])): ?>
    <div class="min-h-full">
        <nav class="bg-white shadow">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 justify-between">
                    <div class="flex">
                        <div class="flex flex-shrink-0 items-center">
                            <a href="/dashboard">
                                <img src="/assets/images/numok-logo.png" alt="Numok" class="h-8" />
                            </a>
                        </div>
                        <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                            <a href="/dashboard" class="<?= $path === 'partner/dashboard' ? 'border-indigo-500 text-gray-900' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700' ?> inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium">Dashboard</a>
                            <a href="/programs" class="<?= $path === 'partner/programs' ? 'border-indigo-500 text-gray-900' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700' ?> inline-flex items-center border-b-2 px-1 pt-1 text-sm font-medium">Programs</a>
                        </div>
                    </div>
                    
                    <div class="hidden sm:ml-6 sm:flex sm:items-center">
                        <!-- User dropdown -->
                        <div class="relative ml-3" x-data="{ open: false }">
                            <div>
                                <button @click="open = !open" type="button" class="flex rounded-full bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" id="user-menu-button">
                                    <span class="sr-only">Open user menu</span>
                                    <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-sm font-medium text-gray-600"><?= strtoupper(substr($_SESSION['partner_company'] ?? 'P', 0, 1)) ?></span>
                                    </div>
                                </button>
                            </div>

                            <div x-show="open" 
                                 @click.away="open = false"
                                 class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" 
                                 role="menu" 
                                 aria-orientation="vertical" 
                                 aria-labelledby="user-menu-button" 
                                 tabindex="-1"
                                 style="display: none;">
                                <div class="block px-4 py-2 text-xs text-gray-400">
                                    Signed in as<br>
                                    <strong class="text-gray-900"><?= htmlspecialchars($_SESSION['partner_company'] ?? '') ?></strong>
                                </div>
                                <div class="border-t border-gray-100"></div>
                                <a href="/settings" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Settings</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Sign out</a>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile menu button -->
                    <div class="flex items-center sm:hidden">
                        <button type="button" @click="mobileMenuOpen = !mobileMenuOpen" class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <span class="sr-only">Open main menu</span>
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile menu -->
            <div class="sm:hidden" x-data="{ mobileMenuOpen: false }" x-show="mobileMenuOpen" style="display: none;">
                <div class="space-y-1 pb-3 pt-2">
                    <a href="/dashboard" class="<?= $path === 'partner/dashboard' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700' ?> block border-l-4 py-2 pl-3 pr-4 text-base font-medium">Dashboard</a>
                    <a href="/programs" class="<?= $path === 'partner/programs' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700' ?> block border-l-4 py-2 pl-3 pr-4 text-base font-medium">Programs</a>
                </div>
                <div class="border-t border-gray-200 pb-3 pt-4">
                    <div class="flex items-center px-4">
                        <div class="flex-shrink-0">
                            <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                                <span class="text-sm font-medium text-gray-600"><?= strtoupper(substr($_SESSION['partner_company'] ?? 'P', 0, 1)) ?></span>
                            </div>
                        </div>
                        <div class="ml-3">
                            <div class="text-base font-medium text-gray-800"><?= htmlspecialchars($_SESSION['partner_company'] ?? '') ?></div>
                            <div class="text-sm font-medium text-gray-500"><?= htmlspecialchars($_SESSION['partner_email'] ?? '') ?></div>
                        </div>
                    </div>
                    <div class="mt-3 space-y-1">
                        <a href="/logout" class="block px-4 py-2 text-base font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-800">Sign out</a>
                    </div>
                </div>
            </div>
        </nav>

        <main>
            <div class="mx-auto max-w-7xl py-6 sm:px-6 lg:px-8">
    <?php else: ?>
        <main>
    <?php endif; ?>

================
File: src/Views/partner/programs/index.php
================
<?php
// File: src/Views/partner/programs/index.php
?>
<div class="py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="sm:flex sm:items-center">
            <div class="sm:flex-auto">
                <h1 class="text-2xl font-semibold text-gray-900">Your Programs</h1>
                <p class="mt-2 text-sm text-gray-700">Join programs and get your tracking links to start earning commissions.</p>
            </div>
        </div>

        <?php if (isset($_SESSION['success'])): ?>
        <div class="rounded-md bg-green-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($_SESSION['success']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['success']); endif; ?>

        <?php if (empty($programs)): ?>
        <div class="text-center mt-16">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">No programs available</h3>
            <p class="mt-1 text-sm text-gray-500">Check back later for new program opportunities.</p>
        </div>
        <?php else: ?>
        <div class="mt-8 grid grid-cols-1 gap-6">
            <?php foreach ($programs as $program): ?>
            <div class="relative rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm hover:border-gray-400">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h3 class="text-lg font-medium text-gray-900"><?= htmlspecialchars($program['name']) ?></h3>
                        <p class="mt-1 text-sm text-gray-500"><?= nl2br(htmlspecialchars($program['description'])) ?></p>
                    </div>
                    <?php if ($program['status'] === 'available'): ?>
                    <form action="/programs/join" method="POST" class="flex-shrink-0">
                        <input type="hidden" name="program_id" value="<?= $program['id'] ?>">
                        <button type="submit" class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                            Join Program
                        </button>
                    </form>
                    <?php endif; ?>
                </div>

                <?php if ($program['status'] === 'joined'): ?>
                <div class="mt-4">
                    <div class="rounded-md bg-gray-50 p-4">
                        <div class="flex-1">
                            <h4 class="text-sm font-medium text-gray-900">Your Tracking Link</h4>
                            <div class="mt-1 flex items-center gap-2">
                                <code class="flex-1 text-sm font-mono bg-white px-2 py-1 rounded border border-gray-200">
                                    <?= htmlspecialchars($program['landing_page']) ?>?via=<?= htmlspecialchars($program['tracking_code']) ?>
                                </code>
                                <button onclick="copyToClipboard('<?= htmlspecialchars($program['landing_page']) ?>?via=<?= htmlspecialchars($program['tracking_code']) ?>')" 
                                        class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Copy
                                </button>
                            </div>
                            <div class="mt-2 flex gap-4 text-sm text-gray-500">
                                <span>Code: <code class="font-mono bg-white px-1 rounded"><?= htmlspecialchars($program['tracking_code']) ?></code></span>
                                <span>Cookie: <?= $program['cookie_days'] ?> days</span>
                            </div>
                        </div>
                    </div>
                </div>
                <?php endif; ?>

                <dl class="mt-4 grid grid-cols-3 gap-4 border-t border-gray-200 pt-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Commission</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <?php if ($program['commission_type'] === 'percentage'): ?>
                                <?= number_format($program['commission_value'], 1) ?>% of sale
                            <?php else: ?>
                                $<?= number_format($program['commission_value'], 2) ?> per sale
                            <?php endif; ?>
                        </dd>
                    </div>
                    <?php if ($program['is_recurring']): ?>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Type</dt>
                        <dd class="mt-1 text-sm text-gray-900">Recurring commission</dd>
                    </div>
                    <?php endif; ?>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Sub IDs Available</dt>
                        <dd class="mt-1 text-sm font-mono text-gray-500">sid, sid2, sid3</dd>
                    </div>
                </dl>
            </div>
            <?php endforeach; ?>
        </div>
        <?php endif; ?>
    </div>
</div>

<script>
async function copyToClipboard(text) {
    try {
        await navigator.clipboard.writeText(text);
        // Show a temporary success message
        const button = event.target.closest('button');
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        setTimeout(() => {
            button.textContent = originalText;
        }, 2000);
    } catch (err) {
        console.error('Failed to copy text: ', err);
    }
}
</script>

================
File: src/Views/partner/settings/index.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-semibold text-gray-900">Account Settings</h1>
    </div>
    
    <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <?php if (isset($_SESSION['settings_success'])): ?>
        <div class="rounded-md bg-green-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($_SESSION['settings_success']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['settings_success']); endif; ?>

        <?php if (isset($_SESSION['settings_error'])): ?>
        <div class="rounded-md bg-red-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['settings_error']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['settings_error']); endif; ?>

        <div class="mt-6 grid grid-cols-1 gap-x-8 gap-y-8 md:grid-cols-3">
            <div class="md:col-span-2">
                <!-- Profile Settings -->
                <div class="bg-white shadow sm:rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-base font-semibold leading-6 text-gray-900">Profile Settings</h3>
                        <div class="mt-4 max-w-xl">
                            <form action="/settings/update" method="POST">
                                <!-- Email -->
                                <div class="mb-4">
                                    <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                    <input type="email" name="email" id="email" 
                                        value="<?= htmlspecialchars($partner['email']) ?>"
                                        class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                    <p class="mt-1 text-sm text-gray-500">This email will be used for logging in and account notifications.</p>
                                </div>

                                <!-- Payment Email -->
                                <div class="mb-4">
                                    <label for="payment_email" class="block text-sm font-medium text-gray-700">Payment Email</label>
                                    <input type="email" name="payment_email" id="payment_email"
                                        value="<?= htmlspecialchars($partner['payment_email']) ?>"
                                        class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                    <p class="mt-1 text-sm text-gray-500">Where your commission payments will be sent.</p>
                                </div>

                                <!-- Current Password -->
                                <div class="mb-4">
                                    <label for="current_password" class="block text-sm font-medium text-gray-700">Current Password</label>
                                    <input type="password" name="current_password" id="current_password" required
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>

                                <!-- New Password -->
                                <div class="mb-4">
                                    <label for="new_password" class="block text-sm font-medium text-gray-700">New Password</label>
                                    <input type="password" name="new_password" id="new_password" minlength="8"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                    <p class="mt-1 text-sm text-gray-500">Leave blank to keep current password. Must be at least 8 characters.</p>
                                </div>

                                <!-- Confirm New Password -->
                                <div class="mb-4">
                                    <label for="confirm_password" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                                    <input type="password" name="confirm_password" id="confirm_password"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>

                                <div class="mt-6">
                                    <button type="submit" 
                                            class="inline-flex justify-center rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                        Update Profile
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help Sidebar -->
            <div class="md:col-span-1">
                <div class="sticky top-6">
                    <div class="rounded-lg bg-white shadow">
                        <div class="px-4 py-5 sm:p-6">
                            <h4 class="text-sm font-medium text-gray-900">Account Security</h4>
                            <div class="mt-4 text-sm text-gray-500 space-y-3">
                                <p>Keep your account secure:</p>
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>Use a strong, unique password</li>
                                    <li>Never share your login credentials</li>
                                    <li>Keep your payment email up to date</li>
                                    <li>Review your account activity regularly</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

================
File: src/Views/partners/create.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="lg:flex lg:items-center lg:justify-between">
            <div class="min-w-0 flex-1">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                    Create Partner
                </h2>
            </div>
            <div class="mt-5 flex lg:ml-4 lg:mt-0">
                <a href="/admin/partners" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    Back
                </a>
            </div>
        </div>

        <?php if (isset($_SESSION['error'])): ?>
        <div class="rounded-md bg-red-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['error']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['error']); endif; ?>

        <form action="/admin/partners/store" method="POST" class="mt-8">
            <div class="space-y-12">
                <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3">
                    <div>
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Partner Information</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">
                            Basic information about the partner and their company.
                        </p>
                    </div>

                    <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2">
                        <div class="sm:col-span-4">
                            <label for="company_name" class="block text-sm font-medium leading-6 text-gray-900">Company Name</label>
                            <div class="mt-2">
                                <input type="text" name="company_name" id="company_name" required
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                        </div>

                        <div class="sm:col-span-4">
                            <label for="contact_name" class="block text-sm font-medium leading-6 text-gray-900">Contact Name</label>
                            <div class="mt-2">
                                <input type="text" name="contact_name" id="contact_name" required
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                        </div>

                        <div class="sm:col-span-4">
                            <label for="email" class="block text-sm font-medium leading-6 text-gray-900">Email</label>
                            <div class="mt-2">
                                <input type="email" name="email" id="email" required
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">This email will be used for account login.</p>
                        </div>

                        <div class="sm:col-span-4">
                            <label for="payment_email" class="block text-sm font-medium leading-6 text-gray-900">Payment Email</label>
                            <div class="mt-2">
                                <input type="email" name="payment_email" id="payment_email"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">Where commission payments will be sent. Leave blank to use login email.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex items-center justify-end gap-x-6 border-t border-gray-900/10 pt-6">
                <a href="/admin/partners" class="text-sm font-semibold leading-6 text-gray-900">Cancel</a>
                <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    Create Partner
                </button>
            </div>
        </form>
    </div>
</div>

================
File: src/Views/partners/edit.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="lg:flex lg:items-center lg:justify-between">
            <div class="min-w-0 flex-1">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                    Edit Partner: <?= htmlspecialchars($partner['company_name']) ?>
                </h2>
            </div>
            <div class="mt-5 flex lg:ml-4 lg:mt-0">
                <a href="/admin/partners" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    Back
                </a>
            </div>
        </div>

        <?php if (isset($_SESSION['success'])): ?>
        <div class="rounded-md bg-green-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($_SESSION['success']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['success']); endif; ?>

        <?php if (isset($_SESSION['error'])): ?>
        <div class="rounded-md bg-red-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['error']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['error']); endif; ?>

        <div class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-2">
            <!-- Partner Information -->
            <div>
                <form action="/admin/partners/<?= $partner['id'] ?>/update" method="POST">
                    <div class="space-y-12">
                        <div class="bg-white shadow sm:rounded-lg">
                            <div class="px-4 py-5 sm:p-6">
                                <h3 class="text-base font-semibold leading-6 text-gray-900">Partner Information</h3>
                                
                                <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                                    <div class="sm:col-span-6">
                                        <label for="company_name" class="block text-sm font-medium text-gray-700">Company Name</label>
                                        <div class="mt-1">
                                            <input type="text" name="company_name" id="company_name" required
                                                value="<?= htmlspecialchars($partner['company_name']) ?>"
                                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                        </div>
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="contact_name" class="block text-sm font-medium text-gray-700">Contact Name</label>
                                        <div class="mt-1">
                                            <input type="text" name="contact_name" id="contact_name" required
                                                value="<?= htmlspecialchars($partner['contact_name']) ?>"
                                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                        </div>
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="payment_email" class="block text-sm font-medium text-gray-700">Payment Email</label>
                                        <div class="mt-1">
                                            <input type="email" name="payment_email" id="payment_email"
                                                value="<?= htmlspecialchars($partner['payment_email']) ?>"
                                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                        </div>
                                        <p class="mt-2 text-sm text-gray-500">Where commission payments will be sent.</p>
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                                        <select id="status" name="status" 
                                                class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                            <option value="pending" <?= $partner['status'] === 'pending' ? 'selected' : '' ?>>Pending</option>
                                            <option value="active" <?= $partner['status'] === 'active' ? 'selected' : '' ?>>Active</option>
                                            <option value="suspended" <?= $partner['status'] === 'suspended' ? 'selected' : '' ?>>Suspended</option>
                                        </select>
                                        <p class="mt-2 text-sm text-gray-500">Partner's current status in the platform.</p>
                                    </div>
                                </div>

                                <div class="mt-6 flex justify-end">
                                    <button type="submit" class="ml-3 inline-flex justify-center rounded-md bg-indigo-600 py-2 px-3 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                        Update Partner
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Programs -->
            <div>
                <div class="bg-white shadow sm:rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-base font-semibold leading-6 text-gray-900">Program Assignments</h3>
                        
                        <?php if ($partner['status'] === 'active'): ?>
                        <form action="/partners/<?= $partner['id'] ?>/assign-program" method="POST" class="mt-4">
                            <div class="flex gap-3">
                                <div class="flex-1">
                                    <select name="program_id" required
                                            class="mt-1 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                        <option value="">Select a program...</option>
                                        <?php foreach ($availablePrograms as $program): ?>
                                        <option value="<?= $program['id'] ?>"><?= htmlspecialchars($program['name']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                                <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                    Assign Program
                                </button>
                            </div>
                        </form>
                        <?php endif; ?>

                        <!-- Program List -->
                        <div class="mt-6">
                            <?php if (empty($programs)): ?>
                            <div class="text-center rounded-lg border-2 border-dashed border-gray-300 p-12">
                                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                </svg>
                                <h3 class="mt-2 text-sm font-medium text-gray-900">No programs</h3>
                                <p class="mt-1 text-sm text-gray-500">Get started by assigning a program to this partner.</p>
                            </div>
                            <?php else: ?>
                            <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
                                <table class="min-w-full divide-y divide-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900">Program</th>
                                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Tracking Code</th>
                                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                            <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                                                <span class="sr-only">Actions</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 bg-white">
                                        <?php foreach ($programs as $program): ?>
                                        <tr>
                                            <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-900">
                                                <div>
                                                    <div class="font-medium"><?= htmlspecialchars($program['program_name']) ?></div>
                                                    <div class="text-gray-500">
                                                        <?php if ($program['commission_type'] === 'percentage'): ?>
                                                            <?= number_format($program['commission_value'], 1) ?>%
                                                        <?php else: ?>
                                                            $<?= number_format($program['commission_value'], 2) ?>
                                                        <?php endif; ?>
                                                        commission
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 font-mono">
                                                <?= htmlspecialchars($program['tracking_code']) ?>
                                            </td>
                                            <td class="whitespace-nowrap px-3 py-4 text-sm">
                                                <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium <?= $program['status'] === 'active' ? 'bg-green-50 text-green-700' : 'bg-yellow-50 text-yellow-700' ?>">
                                                    <?= ucfirst(htmlspecialchars($program['status'])) ?>
                                                </span>
                                            </td>
                                            <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium">
                                                <div x-data="{ copySuccess: false }" class="flex justify-end gap-2">
                                                    <button @click="navigator.clipboard.writeText('<?= htmlspecialchars($program['tracking_code']) ?>'); copySuccess = true; setTimeout(() => copySuccess = false, 2000)" 
                                                            type="button"
                                                            class="text-indigo-600 hover:text-indigo-900">
                                                        <span x-show="!copySuccess">Copy Code</span>
                                                        <span x-show="copySuccess" x-cloak>Copied!</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
[x-cloak] { display: none !important; }
</style>

================
File: src/Views/partners/index.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="sm:flex sm:items-center">
            <div class="sm:flex-auto">
                <h1 class="text-2xl font-semibold text-gray-900">Partners</h1>
                <p class="mt-2 text-sm text-gray-700">A list of all your affiliate partners and their performance.</p>
            </div>
            <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
                <a href="/admin/partners/create" class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                    Create Partner
                </a>
            </div>
        </div>

        <?php if (isset($_SESSION['success'])): ?>
            <div class="rounded-md bg-green-50 p-4 mt-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($_SESSION['success']) ?></p>
                    </div>
                </div>
            </div>
        <?php unset($_SESSION['success']);
        endif; ?>

        <?php if (isset($_SESSION['error'])): ?>
            <div class="rounded-md bg-red-50 p-4 mt-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['error']) ?></p>
                    </div>
                </div>
            </div>
        <?php unset($_SESSION['error']);
        endif; ?>

        <?php if (empty($partners)): ?>
            <div class="text-center mt-16">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No partners</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by creating your first partner.</p>
                <div class="mt-6">
                    <a href="/admin/partners/create" class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                        Create Partner
                    </a>
                </div>
            </div>
        <?php else: ?>
            <div class="mt-8 flow-root">
                <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle">
                        <table class="min-w-full divide-y divide-gray-300">
                            <thead>
                                <tr>
                                    <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Partner</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Programs</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Conversions</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Revenue</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Commission</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                    <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                                        <span class="sr-only">Actions</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <?php foreach ($partners as $partner): ?>
                                    <tr>
                                        <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-900 sm:pl-6">
                                            <div class="flex items-center">
                                                <div class="h-10 w-10 flex-shrink-0">
                                                    <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-500">
                                                        <span class="text-sm font-medium leading-none text-white">
                                                            <?= strtoupper(substr($partner['contact_name'] ?? $partner['company_name'], 0, 1)) ?>
                                                        </span>
                                                    </span>
                                                </div>
                                                <div class="ml-4">
                                                    <div class="font-medium text-gray-900"><?= htmlspecialchars($partner['company_name']) ?></div>
                                                    <div class="text-gray-500">
                                                        <?= htmlspecialchars($partner['contact_name']) ?> · <?= htmlspecialchars($partner['email']) ?>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            <?= number_format($partner['total_programs']) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            <?= number_format($partner['total_conversions']) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($partner['total_revenue'], 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                            $<?= number_format($partner['total_commission'], 2) ?>
                                        </td>
                                        <td class="whitespace-nowrap px-3 py-4 text-sm">
                                            <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium <?php
                                                                                                                            switch ($partner['status']):
                                                                                                                                case 'active':
                                                                                                                                    echo 'bg-green-50 text-green-700';
                                                                                                                                    break;
                                                                                                                                case 'pending':
                                                                                                                                    echo 'bg-yellow-50 text-yellow-700';
                                                                                                                                    break;
                                                                                                                                case 'suspended':
                                                                                                                                    echo 'bg-red-50 text-red-700';
                                                                                                                                    break;
                                                                                                                                default:
                                                                                                                                    echo 'bg-gray-50 text-gray-700';
                                                                                                                            endswitch; ?>">
                                                <?= ucfirst(htmlspecialchars($partner['status'])) ?>
                                            </span>
                                        </td>
                                        <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
                                            <div class="flex items-center justify-end space-x-2">
                                                <!-- Edit Link -->
                                                <a href="/admin/partners/<?= $partner['id'] ?>/edit"
                                                    class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                                                    <svg class="mr-1.5 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                        <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                                                        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                                                    </svg>
                                                    Edit
                                                </a>

                                                <?php if ($partner['status'] === 'pending'): ?>
                                                    <!-- Approve Form -->
                                                    <form action="/admin/partners/<?= $partner['id'] ?>/update"
                                                        method="POST"
                                                        class="inline-block">
                                                        <input type="hidden" name="status" value="active">
                                                        <button type="submit"
                                                            class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-green-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-green-50">
                                                            <svg class="mr-1.5 h-4 w-4 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                                            </svg>
                                                            Approve
                                                        </button>
                                                    </form>
                                                <?php endif; ?>

                                                <?php if ($partner['status'] === 'active'): ?>
                                                    <!-- Suspend Form -->
                                                    <form action="/admin/partners/<?= $partner['id'] ?>/update"
                                                        method="POST"
                                                        class="inline-block">
                                                        <input type="hidden" name="status" value="suspended">
                                                        <button type="submit"
                                                            onclick="return confirm('Are you sure you want to suspend this partner?')"
                                                            class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-yellow-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-yellow-50">
                                                            <svg class="mr-1.5 h-4 w-4 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                            </svg>
                                                            Suspend
                                                        </button>
                                                    </form>
                                                <?php endif; ?>

                                                <!-- Delete Form -->
                                                <form action="/admin/partners/<?= $partner['id'] ?>/delete"
                                                    method="POST"
                                                    onsubmit="return confirm('Are you sure you want to delete this partner?')"
                                                    class="inline-block">
                                                    <button type="submit"
                                                        class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-red-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-red-50">
                                                        <svg class="mr-1.5 h-4 w-4 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                        </svg>
                                                        Delete
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        <?php endif; ?>
    </div>
</div>

================
File: src/Views/programs/create.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="lg:flex lg:items-center lg:justify-between">
            <div class="min-w-0 flex-1">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                    Create Program
                </h2>
            </div>
            <div class="mt-5 flex lg:ml-4 lg:mt-0">
                <span class="hidden sm:block">
                    <a href="/admin/programs" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                        <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                        </svg>
                        Back
                    </a>
                </span>
            </div>
        </div>

        <form action="/admin/programs<?= isset($program) ? "/{$program['id']}/update" : '/store' ?>" method="POST" class="mt-8">
            <div class="space-y-12">
                <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3">
                    <div>
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Program Details</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">
                            Configure your affiliate program settings including commission structure and attribution rules.
                        </p>
                    </div>

                    <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2">
                        <div class="sm:col-span-4">
                            <label for="name" class="block text-sm font-medium leading-6 text-gray-900">Program Name</label>
                            <div class="mt-2">
                                <input type="text" name="name" id="name" required
                                       value="<?= htmlspecialchars($program['name'] ?? '') ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                        </div>

                        <div class="col-span-full">
                            <label for="description" class="block text-sm font-medium leading-6 text-gray-900">Description</label>
                            <div class="mt-2">
                                <textarea id="description" name="description" rows="3" 
                                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3"><?= htmlspecialchars($program['description'] ?? '') ?></textarea>
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">Write a few sentences describing your program to partners.</p>
                        </div>

                        <div class="sm:col-span-4">
                            <label for="landing_page" class="block text-sm font-medium leading-6 text-gray-900">Landing Page URL</label>
                            <div class="mt-2">
                                <input type="url" name="landing_page" id="landing_page" required
                                       value="<?= htmlspecialchars($program['landing_page'] ?? '') ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">The page where partners should send their traffic.</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3">
                    <div>
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Commission Settings</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">
                            Define how partners will be rewarded for bringing customers.
                        </p>
                    </div>

                    <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2">
                        <div class="sm:col-span-3">
                            <label for="commission_type" class="block text-sm font-medium leading-6 text-gray-900">Commission Type</label>
                            <div class="mt-2">
                                <select id="commission_type" name="commission_type" 
                                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                    <option value="percentage" <?= ($program['commission_type'] ?? '') === 'percentage' ? 'selected' : '' ?>>Percentage</option>
                                    <option value="fixed" <?= ($program['commission_type'] ?? '') === 'fixed' ? 'selected' : '' ?>>Fixed Amount</option>
                                </select>
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="commission_value" class="block text-sm font-medium leading-6 text-gray-900">Commission Value</label>
                            <div class="mt-2">
                                <input type="tel" name="commission_value" id="commission_value" step="0.01" required
                                       value="<?= htmlspecialchars($program['commission_value'] ?? '0') ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="cookie_days" class="block text-sm font-medium leading-6 text-gray-900">Cookie Duration (days)</label>
                            <div class="mt-2">
                                <input type="number" name="cookie_days" id="cookie_days" min="1" required
                                       value="<?= htmlspecialchars($program['cookie_days'] ?? '30') ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">How long the attribution will last.</p>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="reward_days" class="block text-sm font-medium leading-6 text-gray-900">Reward Delay (days)</label>
                            <div class="mt-2">
                                <input type="number" name="reward_days" id="reward_days" min="0"
                                       value="<?= htmlspecialchars($program['reward_days'] ?? '0') ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">Days to wait before marking commission as payable.</p>
                        </div>

                        <div class="col-span-full">
                            <div class="relative flex gap-x-3">
                                <div class="flex h-6 items-center">
                                    <input type="checkbox" name="is_recurring" id="is_recurring" 
                                           <?= ($program['is_recurring'] ?? false) ? 'checked' : '' ?>
                                           class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600">
                                </div>
                                <div class="text-sm leading-6">
                                    <label for="is_recurring" class="font-medium text-gray-900">Recurring Commissions</label>
                                    <p class="text-gray-500">Partners will earn commission on all future payments from the customer.</p>
                                </div>
                            </div>
                        </div>

                        <?php if (isset($program)): ?>
                        <div class="sm:col-span-3">
                            <label for="status" class="block text-sm font-medium leading-6 text-gray-900">Status</label>
                            <div class="mt-2">
                                <select id="status" name="status" 
                                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                    <option value="active" <?= $program['status'] === 'active' ? 'selected' : '' ?>>Active</option>
                                    <option value="inactive" <?= $program['status'] === 'inactive' ? 'selected' : '' ?>>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <?php endif; ?>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex items-center justify-end gap-x-6">
                <a href="/admin/programs" class="text-sm font-semibold leading-6 text-gray-900">Cancel</a>
                <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    <?= isset($program) ? 'Update Program' : 'Create Program' ?>
                </button>
            </div>
        </form>
    </div>
</div>

================
File: src/Views/programs/edit.php
================
<?php
// Ensure $program is available
if (!isset($program)) {
    header('Location: /programs');
    exit;
}
?>
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="lg:flex lg:items-center lg:justify-between">
            <div class="min-w-0 flex-1">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                    <?= htmlspecialchars($program['name']) ?>
                </h2>
            </div>
            <div class="mt-5 flex lg:ml-4 lg:mt-0 space-x-3">
                <a href="/admin/programs" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    Back to Programs
                </a>
                <?php if ($program['status'] === 'active'): ?>
                <a href="/admin/programs/<?= $program['id'] ?>/integration" 
                   class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M14.5 10a4.5 4.5 0 004.284-5.882c-.105-.324-.51-.391-.752-.15L15.34 6.66a.454.454 0 01-.493.11 3.01 3.01 0 01-1.618-1.616.455.455 0 01.11-.494l2.694-2.692c.24-.241.174-.647-.15-.752a4.5 4.5 0 00-5.873 4.575c.055.873-.128 1.808-.8 2.368l-7.23 6.024a2.724 2.724 0 103.837 3.837l6.024-7.23c.56-.672 1.495-.855 2.368-.8.096.007.193.01.291.01zM5 16a1 1 0 11-2 0 1 1 0 012 0z" clip-rule="evenodd" />
                    </svg>
                    Integration Guide
                </a>
                <?php endif; ?>
            </div>
        </div>

        <?php if (isset($_SESSION['error'])): ?>
        <div class="rounded-md bg-red-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['error']) ?></p>
                </div>
            </div>
        </div>
        <?php unset($_SESSION['error']); endif; ?>

        <form action="/admin/programs/<?= $program['id'] ?>/update" method="POST" class="mt-8">
            <div class="space-y-12">
                <!-- Program Details Section -->
                <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3">
                    <div>
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Program Details</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">
                            Basic information about your affiliate program.
                        </p>
                    </div>

                    <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2">
                        <div class="sm:col-span-4">
                            <div class="flex justify-between items-center">
                                <label for="name" class="block text-sm font-medium leading-6 text-gray-900">Program Name</label>
                                <span class="text-gray-500 text-xs">Required</span>
                            </div>
                            <div class="mt-2">
                                <input type="text" name="name" id="name" required
                                       value="<?= htmlspecialchars($program['name']) ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                        </div>

                        <div class="col-span-full">
                            <label for="description" class="block text-sm font-medium leading-6 text-gray-900">Description</label>
                            <div class="mt-2">
                                <textarea id="description" name="description" rows="4" 
                                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3"><?= htmlspecialchars($program['description']) ?></textarea>
                            </div>
                            <p class="mt-3 text-sm leading-6 text-gray-600">Write a few sentences about your program for partners.</p>
                        </div>

                        <div class="sm:col-span-4">
                            <label for="landing_page" class="block text-sm font-medium leading-6 text-gray-900">Landing Page URL</label>
                            <div class="mt-2">
                                <input type="url" name="landing_page" id="landing_page" 
                                       value="<?= htmlspecialchars($program['landing_page']) ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3"
                                       placeholder="https://example.com/landing">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">Where partners should send their traffic.</p>
                        </div>
                    </div>
                </div>

                <!-- Commission Settings Section -->
                <div class="grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3">
                    <div>
                        <h2 class="text-base font-semibold leading-7 text-gray-900">Commission Settings</h2>
                        <p class="mt-1 text-sm leading-6 text-gray-600">
                            Configure how partners will be rewarded.
                        </p>
                    </div>

                    <div class="grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2">
                        <div class="sm:col-span-3">
                            <label for="commission_type" class="block text-sm font-medium leading-6 text-gray-900">Commission Type</label>
                            <div class="mt-2">
                                <select id="commission_type" name="commission_type" required
                                        class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                    <option value="percentage" <?= $program['commission_type'] === 'percentage' ? 'selected' : '' ?>>Percentage of Sale</option>
                                    <option value="fixed" <?= $program['commission_type'] === 'fixed' ? 'selected' : '' ?>>Fixed Amount</option>
                                </select>
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="commission_value" class="block text-sm font-medium leading-6 text-gray-900">Commission Value</label>
                            <div class="mt-2">
                                <div class="relative rounded-md shadow-sm">
                                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                        <span class="text-gray-500 sm:text-sm" x-text="$el.closest('form').querySelector('#commission_type').value === 'fixed' ? '$' : ''"></span>
                                    </div>
                                    <input type="number" name="commission_value" id="commission_value" required
                                           min="0" step="0.01"
                                           value="<?= htmlspecialchars($program['commission_value']) ?>"
                                           class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 pl-6">
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                                        <span class="text-gray-500 sm:text-sm" x-text="$el.closest('form').querySelector('#commission_type').value === 'percentage' ? '%' : ''"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="cookie_days" class="block text-sm font-medium leading-6 text-gray-900">Cookie Duration (days)</label>
                            <div class="mt-2">
                                <input type="number" name="cookie_days" id="cookie_days" required
                                       min="1" value="<?= htmlspecialchars($program['cookie_days']) ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">How long the attribution will last.</p>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="reward_days" class="block text-sm font-medium leading-6 text-gray-900">Reward Delay (days)</label>
                            <div class="mt-2">
                                <input type="number" name="reward_days" id="reward_days" required
                                       min="0" value="<?= htmlspecialchars($program['reward_days']) ?>"
                                       class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                            </div>
                            <p class="mt-2 text-sm text-gray-600">Days to wait before marking commission as payable.</p>
                        </div>

                        <div class="col-span-full">
                            <div class="relative flex gap-x-3">
                                <div class="flex h-6 items-center">
                                    <input type="checkbox" name="is_recurring" id="is_recurring" 
                                           <?= $program['is_recurring'] ? 'checked' : '' ?>
                                           class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600">
                                </div>
                                <div class="text-sm leading-6">
                                    <label for="is_recurring" class="font-medium text-gray-900">Recurring Commissions</label>
                                    <p class="text-gray-500">Partners will earn commission on all future payments from referred customers.</p>
                                </div>
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="status" class="block text-sm font-medium leading-6 text-gray-900">Status</label>
                            <div class="mt-2">
                                <select id="status" name="status" 
                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                    <option value="active" <?= $program['status'] === 'active' ? 'selected' : '' ?>>Active</option>
                                    <option value="inactive" <?= $program['status'] === 'inactive' ? 'selected' : '' ?>>Inactive</option>
                                </select>
                                <p class="mt-2 text-sm text-gray-600">Inactive programs won't accept new conversions.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex items-center justify-end gap-x-6 border-t border-gray-900/10 pt-6">
                <button type="button" 
                        onclick="window.location.href='/programs'"
                        class="text-sm font-semibold leading-6 text-gray-900">
                    Cancel
                </button>
                <?php if ($program['status'] === 'active'): ?>
                <button type="submit" 
                        name="status" 
                        value="inactive"
                        class="rounded-md bg-yellow-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-yellow-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-600">
                    Deactivate Program
                </button>
                <?php endif; ?>
                <button type="submit" 
                        class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Update commission value input prefix/suffix based on type
document.getElementById('commission_type').addEventListener('change', function(e) {
    const valueInput = document.getElementById('commission_value');
    const prefix = e.target.value === 'fixed' ? '<?php
// Ensure $program is available
if (!isset($program)) {
    header('Location: /programs');
    exit;
}
?>

================
File: src/Views/programs/index.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="sm:flex sm:items-center">
            <div class="sm:flex-auto">
                <h1 class="text-2xl font-semibold text-gray-900">Programs</h1>
                <p class="mt-2 text-sm text-gray-700">A list of all your affiliate programs and their performance.</p>
            </div>
            <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
                <a href="/admin/programs/create" class="block rounded-md bg-indigo-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                    Create Program
                </a>
            </div>
        </div>

        <?php if (isset($_SESSION['success'])): ?>
            <div class="rounded-md bg-green-50 p-4 mt-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($_SESSION['success']) ?></p>
                    </div>
                </div>
            </div>
        <?php unset($_SESSION['success']);
        endif; ?>

        <?php if (isset($_SESSION['error'])): ?>
            <div class="rounded-md bg-red-50 p-4 mt-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($_SESSION['error']) ?></p>
                    </div>
                </div>
            </div>
        <?php unset($_SESSION['error']);
        endif; ?>

        <?php if (empty($programs)): ?>
            <div class="text-center mt-16">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No programs</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by creating your first affiliate program.</p>
                <div class="mt-6">
                    <a href="/admin/programs/create" class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                        Create Program
                    </a>
                </div>
            </div>
        <?php else: ?>
            <div class="mt-8 ">
                <div class="relative overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-300">
                        <thead>
                            <tr>
                                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Name</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Commission</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Partners</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Conversions</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Revenue</th>
                                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                                    <span class="sr-only">Actions</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <?php foreach ($programs as $program): ?>
                                <tr>
                                    <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm text-gray-900 sm:pl-6">
                                        <div class="flex items-center">
                                            <div>
                                                <div class="font-medium"><?= htmlspecialchars($program['name']) ?></div>
                                                <?php if ($program['landing_page']): ?>
                                                    <a href="<?= htmlspecialchars($program['landing_page']) ?>" target="_blank" class="text-gray-500 hover:text-gray-900 text-xs flex items-center mt-0.5">
                                                        <?= htmlspecialchars($program['landing_page']) ?>
                                                        <svg class="ml-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                                        </svg>
                                                    </a>
                                                <?php endif; ?>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        <?php if ($program['commission_type'] === 'percentage'): ?>
                                            <?= number_format($program['commission_value'], 1) ?>%
                                        <?php else: ?>
                                            $<?= number_format($program['commission_value'], 2) ?>
                                        <?php endif; ?>
                                        <?= $program['is_recurring'] ? ' (recurring)' : '' ?>
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        <?= number_format($program['total_partners']) ?>
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        <?= number_format($program['total_conversions']) ?>
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        $<?= number_format($program['total_revenue'], 2) ?>
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm">
                                        <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium <?= $program['status'] === 'active' ? 'bg-green-50 text-green-700' : 'bg-yellow-50 text-yellow-700' ?>">
                                            <?= ucfirst(htmlspecialchars($program['status'])) ?>
                                        </span>
                                    </td>
                                    <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
                                        <div class="flex items-center justify-end space-x-2">
                                            <!-- Integration Link -->
                                            <a href="/admin/programs/<?= $program['id'] ?>/integration"
                                                class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                                                <svg class="mr-1.5 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M14.5 10a4.5 4.5 0 004.284-5.882c-.105-.324-.51-.391-.752-.15L15.34 6.66a.454.454 0 01-.493.11 3.01 3.01 0 01-1.618-1.616.455.455 0 01.11-.494l2.694-2.692c.24-.241.174-.647-.15-.752a4.5 4.5 0 00-5.873 4.575c.055.873-.128 1.808-.8 2.368l-7.23 6.024a2.724 2.724 0 103.837 3.837l6.024-7.23c.56-.672 1.495-.855 2.368-.8.096.007.193.01.291.01z" clip-rule="evenodd" />
                                                </svg>
                                                Integration
                                            </a>

                                            <!-- Edit Link -->
                                            <a href="/admin/programs/<?= $program['id'] ?>/edit"
                                                class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                                                <svg class="mr-1.5 h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                                    <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                                                    <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                                                </svg>
                                                Edit
                                            </a>

                                            <!-- Delete Form -->
                                            <form action="/admin/programs/<?= $program['id'] ?>/delete"
                                                method="POST"
                                                onsubmit="return confirm('Are you sure you want to delete this program?')"
                                                class="inline-block">
                                                <button type="submit"
                                                    class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-red-600 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-red-50">
                                                    <svg class="mr-1.5 h-4 w-4 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                    </svg>
                                                    Delete
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>

                </div>
            </div>
        <?php endif; ?>
    </div>
</div>

================
File: src/Views/programs/integration.php
================
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="lg:flex lg:items-center lg:justify-between">
            <div class="min-w-0 flex-1">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                    Integration Guide: <?= htmlspecialchars($program['name']) ?>
                </h2>
            </div>
            <div class="mt-5 flex lg:ml-4 lg:mt-0">
                <a href="/admin/programs/<?= $program['id'] ?>/edit" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    <svg class="-ml-0.5 mr-1.5 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    Back to Program
                </a>
            </div>
        </div>

        <div class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-2">
            <!-- Stripe Integration -->
            <div class="bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-base font-semibold leading-6 text-gray-900">Stripe Integration</h3>
                    <div class="mt-2 max-w-xl text-sm text-gray-500">
                        <p>To track affiliate conversions, add the partner's tracking code to your Stripe Checkout Session or Payment Intent metadata.</p>
                    </div>
                    
                    <div class="mt-5">
                        <div class="rounded-md bg-gray-50 p-4">
                            <h4 class="text-sm font-medium text-gray-900">1. Add the Tracking Script</h4>
                            <p class="mt-2 text-sm text-gray-600">Add this script to your website's header:</p>
                            <pre class="mt-2 p-2 bg-gray-100 rounded text-sm overflow-x-auto"><code>&lt;script src="https://<?= $_SERVER['HTTP_HOST'] ?>/tracking/program-<?= $program['id'] ?>.js"&gt;&lt;/script&gt;</code></pre>

                            <h4 class="mt-4 text-sm font-medium text-gray-900">2. Add Tracking to Stripe Checkout</h4>
                            <p class="mt-2 text-sm text-gray-600">When creating a Stripe Checkout Session, add the tracking metadata:</p>
                            <pre class="mt-2 p-2 bg-gray-100 rounded text-sm overflow-x-auto"><code>const session = await stripe.checkout.sessions.create({
  line_items: [...],
  mode: 'payment',
  metadata: window.numok.getStripeMetadata() // Automatically adds tracking data
});</code></pre>
                            
                            <div class="mt-4 rounded-md bg-blue-50 p-3">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm text-blue-700">
                                            The script automatically handles:
                                        </p>
                                        <ul class="mt-2 list-disc list-inside text-sm text-blue-700">
                                            <li>Cookie management and duration</li>
                                            <li>Tracking code detection from URL</li>
                                            <li>Sub-ID tracking (sid, sid2, sid3)</li>
                                            <li>Click and impression tracking</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Webhook Setup -->
            <div class="bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-base font-semibold leading-6 text-gray-900">Webhook Configuration</h3>
                    <div class="mt-2 max-w-xl text-sm text-gray-500">
                        <p>Configure your Stripe webhook endpoint to receive payment notifications.</p>
                    </div>
                    
                    <div class="mt-5">
                        <div class="rounded-md bg-gray-50 p-4">
                            <h4 class="text-sm font-medium text-gray-900">1. Add Webhook Endpoint</h4>
                            <p class="mt-2 text-sm text-gray-600">Add this URL to your Stripe webhook settings:</p>
                            <pre class="mt-2 p-2 bg-gray-100 rounded text-sm"><?= rtrim(htmlspecialchars($settings['app_url'] ?? 'https://'.$_SERVER['HTTP_HOST']), '/') ?>/webhook/stripe</pre>
                            
                            <h4 class="mt-4 text-sm font-medium text-gray-900">2. Select Events</h4>
                            <p class="mt-2 text-sm text-gray-600">Subscribe to these webhook events:</p>
                            <ul class="mt-2 list-disc list-inside text-sm text-gray-600">
                                <li><code>checkout.session.completed</code></li>
                                <li><code>payment_intent.succeeded</code></li>
                                <li><code>invoice.paid</code></li>
                            </ul>
                        </div>

                        <div class="mt-4 flex items-center">
                            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" />
                            </svg>
                            <p class="ml-2 text-sm text-gray-600">Make sure to add metadata before creating the checkout session.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testing Section -->
        <div class="mt-6 bg-white shadow sm:rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h3 class="text-base font-semibold leading-6 text-gray-900">Testing Your Integration</h3>
                <div class="mt-2 max-w-xl text-sm text-gray-500">
                    <p>Follow these steps to test your integration:</p>
                </div>
                
                <div class="mt-5">
                    <div class="rounded-md bg-gray-50 p-4">
                        <ol class="list-decimal list-inside space-y-3 text-sm text-gray-600">
                            <li>Switch to Stripe test mode</li>
                            <li>Create a test partner with a tracking code</li>
                            <li>Add the tracking code to your checkout metadata</li>
                            <li>Complete a test purchase using a <a href="https://stripe.com/docs/testing#cards" target="_blank" class="text-indigo-600 hover:text-indigo-500">Stripe test card</a></li>
                            <li>Verify the conversion appears in your dashboard</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

================
File: src/Views/settings/index.php
================
<?php
// src/Views/settings/index.php
?>
<div class="py-6">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-semibold text-gray-900">Settings</h1>
    </div>
    
    <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <?php if (isset($success)): ?>
        <div class="rounded-md bg-green-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-green-800"><?= htmlspecialchars($success) ?></p>
                </div>
            </div>
        </div>
        <?php endif; ?>

        <?php if (isset($error)): ?>
        <div class="rounded-md bg-red-50 p-4 mt-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-red-800"><?= htmlspecialchars($error) ?></p>
                </div>
            </div>
        </div>
        <?php endif; ?>

        <div class="mt-6 grid grid-cols-1 gap-x-8 gap-y-8 md:grid-cols-3">
            <div class="md:col-span-2 space-y-6">
                <!-- Admin Profile Section -->
                <div class="bg-white shadow sm:rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-base font-semibold leading-6 text-gray-900">Admin Profile</h3>
                        <div class="mt-4 max-w-xl">
                            <form action="/admin/settings/update-profile" method="POST">
                                <!-- Email -->
                                <div class="mb-4">
                                    <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                    <input type="email" name="email" id="email" 
                                           value="<?= htmlspecialchars($_SESSION['user_email']) ?>"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>

                                <!-- Current Password -->
                                <div class="mb-4">
                                    <label for="current_password" class="block text-sm font-medium text-gray-700">Current Password</label>
                                    <input type="password" name="current_password" id="current_password" required
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>

                                <!-- New Password -->
                                <div class="mb-4">
                                    <label for="new_password" class="block text-sm font-medium text-gray-700">New Password</label>
                                    <input type="password" name="new_password" id="new_password" minlength="8"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                    <p class="mt-1 text-sm text-gray-500">Leave blank to keep current password</p>
                                </div>

                                <!-- Confirm New Password -->
                                <div class="mb-4">
                                    <label for="confirm_password" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                                    <input type="password" name="confirm_password" id="confirm_password"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>

                                <div class="mt-6">
                                    <button type="submit" 
                                            class="inline-flex justify-center rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                        Update Profile
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- General Settings -->
                <div class="bg-white shadow sm:rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-base font-semibold leading-6 text-gray-900">General Settings</h3>
                        <div class="mt-4 max-w-xl">
                            <form action="/admin/settings/update" method="POST">
                                <div class="mb-4">
                                    <label for="app_name" class="block text-sm font-medium text-gray-700">Application Name</label>
                                    <input type="text" name="app_name" id="app_name" 
                                           value="<?= htmlspecialchars($settings['app_name'] ?? 'Numok') ?>"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                    <p class="mt-2 text-sm text-gray-500">This name will be displayed throughout the application.</p>
                                </div>

                                <div class="mt-6">
                                    <button type="submit" 
                                            class="inline-flex justify-center rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                        Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Stripe Integration -->
                <div class="bg-white shadow sm:rounded-lg" x-data="{ 
                    testResults: null, 
                    testing: false,
                    async testConnection() {
                        this.testing = true;
                        try {
                            const response = await fetch('/admin/settings/test-connection');
                            this.testResults = await response.json();
                        } catch (error) {
                            this.testResults = {
                                success: false,
                                messages: [{
                                    type: 'error',
                                    text: 'Failed to test connection. Please try again.'
                                }]
                            };
                        } finally {
                            this.testing = false;
                        }
                    }
                }">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-base font-semibold leading-6 text-gray-900">Stripe Integration</h3>
                            <?php if (!empty($settings['stripe_secret_key']) || !empty($settings['stripe_webhook_secret'])): ?>
                            <button type="button"
                                    @click="testConnection()"
                                    :disabled="testing"
                                    class="rounded bg-white px-2 py-1 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50">
                                <span x-show="!testing">Test Connection</span>
                                <span x-show="testing">Testing...</span>
                            </button>
                            <?php endif; ?>
                        </div>
                        
                        <div class="mt-4 space-y-4 max-w-xl">
                            <form action="/admin/settings/update" method="POST">
                                <div class="mb-4">
                                    <label for="stripe_secret_key" class="block text-sm font-medium text-gray-700">Secret Key</label>
                                    <input type="password" name="stripe_secret_key" id="stripe_secret_key" 
                                           value="<?= htmlspecialchars($settings['stripe_secret_key'] ?? '') ?>"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>
                                
                                <div class="mb-4">
                                    <label for="stripe_webhook_secret" class="block text-sm font-medium text-gray-700">Webhook Secret</label>
                                    <input type="password" name="stripe_webhook_secret" id="stripe_webhook_secret" 
                                           value="<?= htmlspecialchars($settings['stripe_webhook_secret'] ?? '') ?>"
                                           class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3">
                                </div>

                                <template x-if="testResults?.messages">
                                    <div class="space-y-3 mb-4">
                                        <template x-for="message in testResults.messages" :key="message.text">
                                            <div :class="{
                                                'rounded-md p-3 text-sm': true,
                                                'bg-green-50 text-green-700': message.type === 'success',
                                                'bg-red-50 text-red-700': message.type === 'error',
                                                'bg-yellow-50 text-yellow-700': message.type === 'warning'
                                            }">
                                                <div class="flex">
                                                    <div class="flex-shrink-0">
                                                        <template x-if="message.type === 'success'">
                                                            <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" />
                                                            </svg>
                                                        </template>
                                                        <template x-if="message.type === 'error'">
                                                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" />
                                                            </svg>
                                                        </template>
                                                        <template x-if="message.type === 'warning'">
                                                            <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" />
                                                            </svg>
                                                        </template>
                                                    </div>
                                                    <span class="ml-2" x-text="message.text"></span>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </template>

                                <div class="mt-6">
                                    <button type="submit" 
                                            class="inline-flex justify-center rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                        Save Stripe Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Partner Settings -->
                <div class="bg-white shadow sm:rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-base font-semibold leading-6 text-gray-900">Partner Settings</h3>
                        <div class="mt-4 max-w-xl">
                            <form action="/admin/settings/update" method="POST">
                                <div class="mb-4">
                                    <label for="partner_welcome_message" class="block text-sm font-medium text-gray-700">Welcome Message</label>
                                    <textarea name="partner_welcome_message" id="partner_welcome_message" rows="4"
                                            class="mt-1 block w-full rounded-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 px-3"><?= htmlspecialchars($settings['partner_welcome_message'] ?? '') ?></textarea>
                                    <p class="mt-2 text-sm text-gray-500">This message will be displayed to partners on their dashboard.</p>
                                </div>

                                <div class="mt-6">
                                    <button type="submit" 
                                            class="inline-flex justify-center rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                        Save Partner Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Sidebar -->
            <div class="md:col-span-1">
                <div class="sticky top-6 space-y-6">
                    <!-- Quick Help -->
                    <div class="rounded-lg bg-white shadow">
                        <div class="px-4 py-5 sm:p-6">
                            <h4 class="text-sm font-medium text-gray-900">Quick Help</h4>
                            <div class="mt-4 text-sm text-gray-500 space-y-3">
                                <p>Configure your main settings here including:</p>
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>Admin profile and security</li>
                                    <li>Application general settings</li>
                                    <li>Stripe payment integration</li>
                                    <li>Partner portal configuration</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Stripe Integration Guide -->
                    <div class="rounded-lg bg-white shadow">
                        <div class="px-4 py-5 sm:p-6">
                            <h4 class="text-sm font-medium text-gray-900">Stripe Integration Guide</h4>
                            <div class="mt-2 text-sm text-gray-500 space-y-4">
                                <p>To set up Stripe integration:</p>
                                <ol class="list-decimal pl-4 space-y-2">
                                    <li>Go to your <a href="https://dashboard.stripe.com/apikeys" class="text-indigo-600 hover:text-indigo-500" target="_blank">Stripe Dashboard</a></li>
                                    <li>Copy your Secret Key</li>
                                    <li>Create a new webhook endpoint pointing to:
                                        <code class="block mt-1 p-2 bg-gray-50 rounded text-xs"><?= htmlspecialchars(rtrim($settings['app_url'] ?? 'https://'.$_SERVER['HTTP_HOST'], '/') . '/webhook/stripe') ?></code>
                                    </li>
                                    <li>Copy the webhook signing secret</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

================
File: .gitignore
================
.DS_Store
config/
tracking/

================
File: composer.json
================
{
    "name": "numok/affiliate-platform",
    "description": "Open Source Affiliate Program Platform",
    "type": "project",
    "require": {
        "php": ">=8.1",
        "stripe/stripe-php": "^10.0"
    },
    "autoload": {
        "psr-4": {
            "Numok\\": "src/"
        }
    },
    "authors": [
        {
            "name": "Numok",
            "email": "opensource@numok.com"
        }
    ]
}

================
File: composer.lock
================
{
    "_readme": [
        "This file locks the dependencies of your project to a known state",
        "Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies",
        "This file is @generated automatically"
    ],
    "content-hash": "8c5c4869f1ab6e28405a3abb6ad94fa7",
    "packages": [
        {
            "name": "stripe/stripe-php",
            "version": "v10.21.0",
            "source": {
                "type": "git",
                "url": "https://github.com/stripe/stripe-php.git",
                "reference": "b4ab319731958077227fad1874a3671458c5d593"
            },
            "dist": {
                "type": "zip",
                "url": "https://api.github.com/repos/stripe/stripe-php/zipball/b4ab319731958077227fad1874a3671458c5d593",
                "reference": "b4ab319731958077227fad1874a3671458c5d593",
                "shasum": ""
            },
            "require": {
                "ext-curl": "*",
                "ext-json": "*",
                "ext-mbstring": "*",
                "php": ">=5.6.0"
            },
            "require-dev": {
                "friendsofphp/php-cs-fixer": "3.5.0",
                "php-coveralls/php-coveralls": "^2.5",
                "phpstan/phpstan": "^1.2",
                "phpunit/phpunit": "^5.7 || ^9.0",
                "squizlabs/php_codesniffer": "^3.3"
            },
            "type": "library",
            "extra": {
                "branch-alias": {
                    "dev-master": "2.0-dev"
                }
            },
            "autoload": {
                "psr-4": {
                    "Stripe\\": "lib/"
                }
            },
            "notification-url": "https://packagist.org/downloads/",
            "license": [
                "MIT"
            ],
            "authors": [
                {
                    "name": "Stripe and contributors",
                    "homepage": "https://github.com/stripe/stripe-php/contributors"
                }
            ],
            "description": "Stripe PHP Library",
            "homepage": "https://stripe.com/",
            "keywords": [
                "api",
                "payment processing",
                "stripe"
            ],
            "support": {
                "issues": "https://github.com/stripe/stripe-php/issues",
                "source": "https://github.com/stripe/stripe-php/tree/v10.21.0"
            },
            "time": "2023-08-11T00:23:24+00:00"
        }
    ],
    "packages-dev": [],
    "aliases": [],
    "minimum-stability": "stable",
    "stability-flags": [],
    "prefer-stable": false,
    "prefer-lowest": false,
    "platform": {
        "php": ">=8.1"
    },
    "platform-dev": [],
    "plugin-api-version": "2.6.0"
}

================
File: readme.md
================
# numok: Open Source Affiliate Program Platform

An open source affiliate program that connects to Stripe to track payments.

Installation Guide
==================

Requirements
------------

-   PHP 8.1 or higher
-   MySQL 5.7 or higher
-   Apache/Nginx web server
-   Composer
-   SSL certificate (required for Stripe integration)
-   Stripe account

Step-by-Step Installation
-------------------------

### 1\. Prepare Your Server

```
# Install required PHP extensions
php -v  # Verify PHP version
php -m  # Check for required extensions:
        # - PDO
        # - PDO_MySQL
        # - json
        # - mbstring
```

### 2\. Get the Code

```
# Clone the repository
git clone https://github.com/numok/numok.git
cd numok
```

# Install dependencies
`composer install`

### 3\. Database Setup

```
# Create a new MySQL database
mysql -u root -p
CREATE DATABASE numok CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 4\. Configuration

1.  Copy the example configuration file:

    `cp config/config.example.php config/config.php`

2.  Edit `config/config.php` with your settings:

    ```
    return [
        'db' => [
            'host' => 'localhost',
            'database' => 'numok',
            'username' => 'your_db_user',
            'password' => 'your_db_password'
        ],
        'app' => [
            'url' => 'https://your-domain.com'
        ]
    ];
    ```

### 5\. Database Migration

```
# Import the database structure
mysql -u your_db_user -p numok < database/numok-0-1.sql
```

### 6\. Web Server Configuration

#### Apache

Ensure mod_rewrite is enabled and `.htaccess` is working:

```
<VirtualHost *:80>
    DocumentRoot /path/to/numok/public
    <Directory /path/to/numok/public>
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

#### Nginx

```
server {
    listen  80;
    server_name your-domain.com;
    root /path/to/numok/public;

    location / {
        try_files  $uri  $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 7\. File Permissions

```
# Set proper permissions
chmod -R 755 public/
chmod -R 755 src/
chmod -R 777 public/tracking/
```

### 8\. Create Admin Account

Since Numok separates admins (users table) from partners (partners table), you'll need to create the first admin account directly in the database:

```
-- Insert the first admin user
INSERT INTO users (
    email,
    password,
    name,
    is_admin,
    created_at
) VALUES (
    'admin@yourdomain.com',
    -- This creates a password hash for 'admin123'
    '$2y$10$bLQ3Qd64NRSxvc7A2wKJAe/ocgCCkB5jbyC11I1XklnjDClzO6vpK',
    'Admin User',
    1,
    CURRENT_TIMESTAMP
);
```

After running this SQL:
1\.  Access `/admin/login`
2\.  Login with:
    -   Email: `admin@yourdomain.com`
    -   Password: `admin123`
3\.  **Important**: Immediately go to your profile settings and change your password

### 9\. Stripe Integration

1.  Log in to your admin account
2.  Go to Settings
3.  Enter your Stripe credentials:
    -   Secret Key
    -   Webhook Secret
4.  Configure your webhook endpoint in Stripe's dashboard:
    -   URL: `https://your-domain.com/webhook/stripe`
    -   Events to send:
        -   `checkout.session.completed`
        -   `payment_intent.succeeded`
        -   `invoice.paid`

Security Checklist
------------------

-   [ ]  Use HTTPS only
-   [ ]  Set secure file permissions
-   [ ]  Change default database credentials
-   [ ]  Enable error reporting only in development
-   [ ]  Configure PHP settings properly
-   [ ]  Set up SSL certificate
-   [ ]  Configure server firewall

Troubleshooting
---------------

### Common Issues

1.  **500 Internal Server Error**
    -   Check PHP error logs
    -   Verify file permissions
    -   Confirm .htaccess is working
2.  **Database Connection Failed**
    -   Verify database credentials
    -   Check MySQL server is running
    -   Confirm PHP PDO extension is installed
3.  **Webhook Errors**
    -   Verify SSL certificate is valid
    -   Check Stripe webhook secret
    -   Confirm webhook URL is accessible

Support
-------

-   GitHub Issues: Report bugs and feature requests
-   Documentation: https://numok.com
